<!DOCTYPE html>
<html lang="zh-Hant">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kuromi Travel | 叛逆去旅行</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        /* Kuromi Color System */
        :root {
            --k-bg-dark: #1A1A1A;
            --k-bg-purple: #3E204F;
            --k-accent-purple: #9B72AA;
            --k-accent-pink: #EA68A2;
            --k-white: #FFFFFF;
            --k-grey: #E0E0E0;
        }

        body {
            background-color: var(--k-bg-dark);
            color: var(--k-white);
            font-family: 'Noto Sans TC', sans-serif;
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: var(--k-bg-dark);
        }

        ::-webkit-scrollbar-thumb {
            background: var(--k-accent-purple);
            border-radius: 4px;
        }

        /* Utilities */
        .text-k-pink {
            color: var(--k-accent-pink);
        }

        .bg-k-pink {
            background-color: var(--k-accent-pink);
        }

        .bg-k-purple {
            background-color: var(--k-bg-purple);
        }

        .border-k-pink {
            border-color: var(--k-accent-pink);
        }

        /* Punk/Kuromi Style Elements */
        .btn-primary {
            background-color: var(--k-accent-pink);
            color: white;
            font-weight: bold;
            transition: all 0.3s ease;
            box-shadow: 0 4px 0 #9c3e68;
            /* Retro button depth */
        }

        .btn-primary:hover {
            transform: translateY(2px);
            box-shadow: 0 2px 0 #9c3e68;
            filter: brightness(1.1);
        }

        .btn-primary:active {
            transform: translateY(4px);
            box-shadow: none;
        }

        .card-hover {
            transition: all 0.3s ease;
            border: 1px solid transparent;
        }

        .card-hover:hover {
            border-color: var(--k-accent-purple);
            transform: translateY(-5px);
            box-shadow: 0 0 15px rgba(155, 114, 170, 0.4);
        }

        .nav-item.active {
            color: var(--k-accent-pink);
            border-bottom: 2px solid var(--k-accent-pink);
        }

        /* Skull Pattern Background for Header */
        .skull-pattern {
            background-image: radial-gradient(var(--k-bg-purple) 15%, transparent 16%),
                radial-gradient(var(--k-bg-purple) 15%, transparent 16%);
            background-size: 20px 20px;
            background-position: 0 0, 10px 10px;
            opacity: 0.3;
        }

        /* Tab Styling */
        .search-tab.active {
            background-color: var(--k-accent-pink);
            color: white;
        }

        /* Form Elements */
        input,
        select {
            background-color: #2A2A2A;
            border: 1px solid #444;
            color: white;
        }

        input:focus,
        select:focus {
            outline: none;
            border-color: var(--k-accent-pink);
            box-shadow: 0 0 5px var(--k-accent-pink);
        }

        /* Hidden Pages for SPA */
        .page-section {
            display: none;
            animation: fadeIn 0.5s ease;
        }

        .page-section.active {
            display: block;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Oracle Modal Styles */
        #oracle-modal {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.95);
            z-index: 100;
            display: none;
            align-items: center;
            justify-content: center;
            animation: fadeIn 0.3s ease;
        }

        #oracle-modal.active {
            display: flex;
        }

        .oracle-content {
            max-width: 600px;
            width: 90%;
            background: linear-gradient(135deg, #1A1A1A 0%, #3E204F 100%);
            border: 2px solid var(--k-accent-purple);
            border-radius: 20px;
            padding: 40px;
            position: relative;
            box-shadow: 0 0 50px rgba(155, 114, 170, 0.5);
        }

        .oracle-close {
            position: absolute;
            top: 20px;
            right: 20px;
            background: none;
            border: none;
            color: var(--k-grey);
            font-size: 24px;
            cursor: pointer;
            transition: color 0.3s;
        }

        .oracle-close:hover {
            color: var(--k-accent-pink);
        }

        .oracle-stage {
            display: none;
            text-align: center;
        }

        .oracle-stage.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }

        .oracle-option-btn {
            display: block;
            width: 100%;
            padding: 15px;
            margin: 10px 0;
            background: #222;
            border: 2px solid #444;
            color: white;
            font-size: 16px;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .oracle-option-btn:hover {
            border-color: var(--k-accent-pink);
            background: var(--k-bg-purple);
            transform: translateX(5px);
        }

        @keyframes pulse {

            0%,
            100% {
                transform: scale(1);
            }

            50% {
                transform: scale(1.1);
            }
        }

        .oracle-fab {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 70px;
            height: 70px;
            background: var(--k-accent-pink);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 32px;
            color: white;
            cursor: pointer;
            box-shadow: 0 4px 20px rgba(234, 104, 162, 0.6);
            animation: pulse 2s infinite;
            z-index: 50;
            border: 3px solid white;
        }

        .oracle-fab:hover {
            animation: none;
            transform: scale(1.1);
        }

        /* Scroll Animations */
        .fade-in-up {
            opacity: 0;
            transform: translateY(30px);
            transition: opacity 0.6s ease-out, transform 0.6s ease-out;
        }

        .fade-in-up.visible {
            opacity: 1;
            transform: translateY(0);
        }

        /* Wishlist Heart Icon */
        .wishlist-heart {
            position: absolute;
            top: 10px;
            right: 10px;
            width: 40px;
            height: 40px;
            background: rgba(0, 0, 0, 0.7);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            z-index: 10;
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }

        .wishlist-heart:hover {
            background: var(--k-accent-pink);
            border-color: white;
            transform: scale(1.1);
        }

        .wishlist-heart.favorited {
            background: var(--k-accent-pink);
            animation: heartPulse 0.3s ease;
        }

        @keyframes heartPulse {

            0%,
            100% {
                transform: scale(1);
            }

            50% {
                transform: scale(1.2);
            }
        }
    </style>
</head>

<body class="flex flex-col min-h-screen">

    <!-- Navbar (Sticky) -->
    <nav class="sticky top-0 z-50 bg-[#151515] border-b border-[#3E204F] shadow-lg">
        <div class="container mx-auto px-4 h-16 flex items-center justify-between">
            <!-- Logo -->
            <div class="flex items-center space-x-2 cursor-pointer" onclick="router('home')">
                <div
                    class="w-10 h-10 bg-k-pink rounded-full flex items-center justify-center text-white text-xl font-bold border-2 border-white">
                    <i class="fa-solid fa-skull"></i>
                </div>
                <span class="text-2xl font-black tracking-tighter italic text-white">KUROMI<span
                        class="text-k-pink">TRAVEL</span></span>
            </div>

            <!-- Desktop Menu -->
            <div class="hidden md:flex items-center space-x-8 text-sm font-medium text-gray-300">
                <a href="#" onclick="router('search')" class="nav-item hover:text-white transition">找機票</a>
                <a href="#" onclick="router('search')" class="nav-item hover:text-white transition">找訂房</a>
                <a href="#" onclick="router('search')" class="nav-item hover:text-white transition">團體旅遊</a>
                <a href="#" onclick="router('search')" class="nav-item hover:text-white transition">票券當地遊</a>
            </div>

            <!-- User Actions -->
            <div class="flex items-center space-x-4">
                <button class="text-gray-400 hover:text-white"><i class="fa-solid fa-magnifying-glass"></i></button>
                <button class="text-gray-400 hover:text-white relative" onclick="router('favorites')">
                    <i class="fa-solid fa-heart"></i>
                    <span id="favorites-counter"
                        class="absolute -top-2 -right-2 w-4 h-4 bg-k-pink rounded-full text-[10px] flex items-center justify-center text-white hidden">0</span>
                </button>
                <button class="text-gray-400 hover:text-white relative" onclick="router('checkout')">
                    <i class="fa-solid fa-cart-shopping"></i>
                    <span id="cart-badge"
                        class="absolute -top-2 -right-2 w-4 h-4 bg-k-pink rounded-full text-[10px] flex items-center justify-center text-white hidden">0</span>
                </button>
                <button onclick="router('login')"
                    class="hidden md:block border border-[#9B72AA] text-[#9B72AA] px-4 py-1 rounded hover:bg-[#9B72AA] hover:text-white transition text-sm font-bold">
                    登入/註冊
                </button>
                <!-- Mobile Menu Btn -->
                <button class="md:hidden text-white text-xl" onclick="toggleMobileMenu()">
                    <i class="fa-solid fa-bars"></i>
                </button>
            </div>
        </div>
    </nav>

    <!-- Mobile Menu Overlay -->
    <div id="mobile-menu"
        class="fixed inset-0 bg-[#151515] z-40 hidden flex-col pt-24 px-8 space-y-8 transition-opacity duration-300">
        <button onclick="toggleMobileMenu()" class="absolute top-6 right-6 text-gray-400 hover:text-white text-2xl">
            <i class="fa-solid fa-times"></i>
        </button>
        <a href="#" onclick="router('search'); toggleMobileMenu()"
            class="text-2xl font-bold text-white hover:text-k-pink border-b border-gray-800 pb-4 block">找機票</a>
        <a href="#" onclick="router('search'); toggleMobileMenu()"
            class="text-2xl font-bold text-white hover:text-k-pink border-b border-gray-800 pb-4 block">找訂房</a>
        <a href="#" onclick="router('search'); toggleMobileMenu()"
            class="text-2xl font-bold text-white hover:text-k-pink border-b border-gray-800 pb-4 block">團體旅遊</a>
        <a href="#" onclick="router('search'); toggleMobileMenu()"
            class="text-2xl font-bold text-white hover:text-k-pink border-b border-gray-800 pb-4 block">票券當地遊</a>
    </div>

    <!-- MAIN CONTENT CONTAINER -->
    <main id="app-container" class="flex-grow relative">

        <!-- 1. INDEX PAGE -->
        <section id="home" class="page-section active">
            <!-- Hero Section -->
            <div class="relative h-[500px] bg-gray-900">
                <!-- Abstract Kuromi BG -->
                <div
                    class="absolute inset-0 bg-[url('https://images.unsplash.com/photo-1476514525535-07fb3b4ae5f1?q=80&w=2070&auto=format&fit=crop')] bg-cover bg-center opacity-40 mix-blend-luminosity">
                </div>
                <div class="absolute inset-0 bg-gradient-to-t from-[#1A1A1A] via-[#3E204F]/40 to-transparent"></div>

                <div class="relative container mx-auto px-4 h-full flex flex-col justify-center z-10">
                    <h1 class="text-5xl md:text-6xl font-black text-white mb-4 drop-shadow-lg">
                        帶你 <span class="text-k-pink italic">叛逆</span> 去旅行
                    </h1>
                    <p class="text-gray-300 text-xl mb-8 max-w-2xl">不走尋常路，這是一場屬於黑色幽默與粉色浪漫的冒險。</p>
                </div>

                <!-- Search Widget (Floating) -->
                <div class="absolute -bottom-24 left-0 right-0 px-4 z-20">
                    <div
                        class="container mx-auto bg-[#222] border border-[#3E204F] rounded-xl shadow-2xl p-6 max-w-4xl">
                        <!-- Tabs -->
                        <div class="flex space-x-2 mb-4 border-b border-gray-700 pb-2">
                            <button onclick="switchSearchTab('flight')" id="tab-flight"
                                class="search-tab active px-4 py-2 rounded-t-lg font-bold text-sm flex items-center gap-2 transition-colors">
                                <i class="fa-solid fa-plane"></i> 機票
                            </button>
                            <button onclick="switchSearchTab('hotel')" id="tab-hotel"
                                class="search-tab text-gray-400 hover:text-white px-4 py-2 rounded-t-lg font-bold text-sm flex items-center gap-2 transition-colors">
                                <i class="fa-solid fa-hotel"></i> 訂房
                            </button>
                            <button onclick="switchSearchTab('itinerary')" id="tab-itinerary"
                                class="search-tab text-gray-400 hover:text-white px-4 py-2 rounded-t-lg font-bold text-sm flex items-center gap-2 transition-colors">
                                <i class="fa-solid fa-suitcase"></i> 團體
                            </button>
                        </div>
                        <!-- Search Form -->
                        <div id="flight-search-form" class="grid grid-cols-1 md:grid-cols-5 gap-4 items-end">
                            <div class="flex flex-col">
                                <label class="text-xs text-gray-400 mb-1">出發地</label>
                                <input id="flight-origin" type="text" value="TPE"
                                    class="w-full p-2 rounded bg-[#333] border border-gray-600 focus:border-k-pink text-white uppercase"
                                    placeholder="城市/機場代碼">
                            </div>
                            <div class="flex flex-col">
                                <label class="text-xs text-gray-400 mb-1">目的地</label>
                                <input id="flight-dest" type="text"
                                    class="w-full p-2 rounded bg-[#333] border border-gray-600 focus:border-k-pink text-white uppercase"
                                    placeholder="城市/機場代碼">
                            </div>
                            <div class="flex flex-col">
                                <label class="text-xs text-gray-400 mb-1">去程日期</label>
                                <input id="flight-date" type="date"
                                    class="w-full p-2 rounded bg-[#333] border border-gray-600 text-white">
                            </div>
                            <div class="flex flex-col">
                                <label class="text-xs text-gray-400 mb-1">航空公司 (選填)</label>
                                <select id="flight-airline"
                                    class="w-full p-2 rounded bg-[#333] border border-gray-600 text-white">
                                    <option value="all">所有航空公司</option>
                                    <option value="Kuromi Air">Kuromi Air - 叛逆搖滾</option>
                                    <option value="Melody Airways">Melody Airways - 粉紅夢幻</option>
                                    <option value="Badtz-Maru Jet">Badtz-Maru Jet - 極簡帥氣</option>
                                    <option value="Cinnamoroll Sky">Cinnamoroll Sky - 雲朵溫柔</option>
                                    <option value="Pompompurin Express">Pompompurin Express - 悠閒布丁</option>
                                    <option value="Little Twin Stars Galaxy">Little Twin Stars Galaxy - 星空奇幻</option>
                                    <option value="Keroppi Frog Air">Keroppi Frog Air - 生態環保</option>
                                    <option value="Gudetama Lazy Flight">Gudetama Lazy Flight - 慵懶舒適</option>
                                </select>
                            </div>
                            <div class="flex items-end">
                                <button onclick="searchFlights()"
                                    class="w-full bg-k-pink hover:bg-pink-600 text-white font-bold py-2 px-4 rounded transition">
                                    搜尋機票
                                </button>
                            </div>
                        </div>
                        <!-- Hotel Search Form (Initially Hidden) -->
                        <div id="hotel-search-form" class="hidden grid grid-cols-1 md:grid-cols-5 gap-4 items-end">
                            <div class="flex flex-col">
                                <label class="text-xs text-gray-400 mb-1">國家</label>
                                <select id="hotel-country"
                                    class="w-full p-2 rounded bg-[#333] border border-gray-600 text-white"
                                    onchange="updateHotelOptions()">
                                    <option value="">請選擇國家</option>
                                    <!-- Asia -->
                                    <option value="Japan">日本 Japan</option>
                                    <option value="Korea">韓國 Korea</option>
                                    <option value="Thailand">泰國 Thailand</option>
                                    <option value="Singapore">新加坡 Singapore</option>
                                    <option value="Taiwan">台灣 Taiwan</option>
                                    <!-- Europe -->
                                    <option value="Germany">德國 Germany</option>
                                    <option value="France">法國 France</option>
                                    <option value="Czech Republic">捷克 Czech Republic</option>
                                    <option value="Netherlands">荷蘭 Netherlands</option>
                                    <option value="Iceland">冰島 Iceland</option>
                                    <option value="UK">英國 UK</option>
                                    <option value="Spain">西班牙 Spain</option>
                                    <option value="Italy">義大利 Italy</option>
                                    <!-- Americas -->
                                    <option value="USA">美國 USA</option>
                                    <option value="Mexico">墨西哥 Mexico</option>
                                    <option value="Brazil">巴西 Brazil</option>
                                    <option value="Argentina">阿根廷 Argentina</option>
                                    <!-- Oceania -->
                                    <option value="Australia">澳洲 Australia</option>
                                    <option value="New Zealand">紐西蘭 New Zealand</option>
                                    <!-- Africa & Middle East -->
                                    <option value="Egypt">埃及 Egypt</option>
                                    <option value="UAE">阿聯酋 UAE</option>
                                    <option value="Morocco">摩洛哥 Morocco</option>
                                    <option value="South Africa">南非 South Africa</option>
                                </select>
                            </div>
                            <div class="flex flex-col">
                                <label class="text-xs text-gray-400 mb-1">飯店</label>
                                <select id="hotel-name"
                                    class="w-full p-2 rounded bg-[#333] border border-gray-600 text-white">
                                    <option value="">請先選擇國家</option>
                                </select>
                            </div>
                            <div class="flex flex-col">
                                <label class="text-xs text-gray-400 mb-1">房型</label>
                                <select id="hotel-room-type"
                                    class="w-full p-2 rounded bg-[#333] border border-gray-600 text-white">
                                    <option value="standard">標準房</option>
                                    <option value="deluxe">豪華房</option>
                                    <option value="suite">行政套房</option>
                                </select>
                            </div>
                            <div class="flex flex-col justify-center space-y-2">
                                <label class="flex items-center space-x-2 cursor-pointer">
                                    <input type="checkbox" id="hotel-bathtub"
                                        class="form-checkbox text-k-pink rounded bg-[#333] border-gray-600">
                                    <span class="text-sm text-gray-300">有浴缸</span>
                                </label>
                                <label class="flex items-center space-x-2 cursor-pointer">
                                    <input type="checkbox" id="hotel-breakfast"
                                        class="form-checkbox text-k-pink rounded bg-[#333] border-gray-600">
                                    <span class="text-sm text-gray-300">附早餐</span>
                                </label>
                            </div>
                            <div class="flex items-end">
                                <button onclick="searchHotels()"
                                    class="w-full bg-k-pink hover:bg-pink-600 text-white font-bold py-2 px-4 rounded transition">
                                    搜尋訂房
                                </button>
                            </div>
                        </div>
                        <!-- Itinerary Search Form (Initially Hidden) -->
                        <div id="itinerary-search-form" class="hidden grid grid-cols-1 md:grid-cols-4 gap-4">
                            <div class="flex flex-col">
                                <label class="text-xs text-gray-400 mb-1">出發地 (機場代碼)</label>
                                <select id="itinerary-origin"
                                    class="w-full p-2 rounded bg-[#333] border border-gray-600 focus:border-k-pink">
                                    <option value="TPE">TPE 台北 (桃園)</option>
                                    <option value="TSA">TSA 台北 (松山)</option>
                                    <option value="KHH">KHH 高雄</option>
                                </select>
                            </div>
                            <div class="flex flex-col">
                                <label class="text-xs text-gray-400 mb-1">目的地 (輸入代碼/城市)</label>
                                <input id="itinerary-dest" type="text"
                                    class="w-full p-2 rounded bg-[#333] border border-gray-600"
                                    placeholder="例如: NRT (東京), KIX (大阪)">
                            </div>
                            <div class="flex flex-col">
                                <label class="text-xs text-gray-400 mb-1">去程日期</label>
                                <input id="itinerary-date" type="date"
                                    class="w-full p-2 rounded bg-[#333] border border-gray-600">
                            </div>
                            <div class="flex items-end">
                                <button onclick="searchItinerariesFromHome()"
                                    class="w-full btn-primary py-3 rounded-lg font-bold text-lg shadow-[0_4px_0_#9c3e68] active:shadow-none active:translate-y-[4px] transition-all">
                                    <i class="fa-solid fa-plane-departure mr-2"></i> 搜尋行程
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Oracle FAB Button -->
            <div class="oracle-fab" onclick="openOracle()" title="庫洛米占卜">
                <i class="fa-solid fa-crystal-ball"></i>
            </div>

            <!-- Spacer for Widget -->
            <div class="h-32 bg-[#1A1A1A]"></div>

            <!-- Icon Grid -->
            <div class="container mx-auto px-4 mb-16">
                <div class="grid grid-cols-4 md:grid-cols-8 gap-4 text-center">
                    <div class="group cursor-pointer">
                        <div
                            class="w-14 h-14 mx-auto bg-[#2A2A2A] rounded-2xl flex items-center justify-center mb-2 group-hover:bg-k-pink transition border border-gray-700">
                            <i class="fa-solid fa-torii-gate text-xl text-gray-400 group-hover:text-white"></i>
                        </div>
                        <span class="text-xs text-gray-400 group-hover:text-white">日本</span>
                    </div>
                    <div class="group cursor-pointer">
                        <div
                            class="w-14 h-14 mx-auto bg-[#2A2A2A] rounded-2xl flex items-center justify-center mb-2 group-hover:bg-k-pink transition border border-gray-700">
                            <i class="fa-solid fa-bowl-food text-xl text-gray-400 group-hover:text-white"></i>
                        </div>
                        <span class="text-xs text-gray-400 group-hover:text-white">韓國</span>
                    </div>
                    <div class="group cursor-pointer">
                        <div
                            class="w-14 h-14 mx-auto bg-[#2A2A2A] rounded-2xl flex items-center justify-center mb-2 group-hover:bg-k-pink transition border border-gray-700">
                            <i class="fa-solid fa-umbrella-beach text-xl text-gray-400 group-hover:text-white"></i>
                        </div>
                        <span class="text-xs text-gray-400 group-hover:text-white">東南亞</span>
                    </div>
                    <div class="group cursor-pointer">
                        <div
                            class="w-14 h-14 mx-auto bg-[#2A2A2A] rounded-2xl flex items-center justify-center mb-2 group-hover:bg-k-pink transition border border-gray-700">
                            <i class="fa-solid fa-landmark text-xl text-gray-400 group-hover:text-white"></i>
                        </div>
                        <span class="text-xs text-gray-400 group-hover:text-white">歐洲</span>
                    </div>
                    <!-- Add more icons as needed -->
                </div>
            </div>

            <!-- Hot Deals -->
            <div class="container mx-auto px-4 mb-20">
                <div class="flex items-end justify-between mb-8">
                    <div>
                        <h2 class="text-2xl font-bold text-white mb-1"><i
                                class="fa-solid fa-fire text-k-pink mr-2"></i>熱門推薦</h2>
                        <p class="text-gray-400 text-sm">手慢無！庫洛米精選暗黑系旅程</p>
                    </div>
                    <a href="#" class="text-k-pink text-sm hover:underline">查看更多 <i
                            class="fa-solid fa-arrow-right"></i></a>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                    <!-- Card 1 -->
                    <div class="bg-[#222] rounded-xl overflow-hidden card-hover cursor-pointer fade-in-up"
                        onclick="showDetail('tokyo')">
                        <div class="relative h-48">
                            <img src="https://images.unsplash.com/photo-1540959733332-eab4deabeeaf?q=80&w=1994&auto=format&fit=crop"
                                alt="Tokyo" class="w-full h-full object-cover opacity-80">
                            <div class="wishlist-heart" onclick="event.stopPropagation(); toggleFavorite('tokyo')"
                                data-id="tokyo">
                                <i class="fa-regular fa-heart text-white text-xl"></i>
                            </div>
                            <div
                                class="absolute top-2 right-2 bg-k-pink text-white text-xs px-2 py-1 rounded font-bold">
                                無購物</div>
                        </div>
                        <div class="p-4">
                            <div class="flex gap-2 mb-2">
                                <span class="text-[10px] border border-[#9B72AA] text-[#9B72AA] px-1 rounded">東京</span>
                                <span class="text-[10px] border border-gray-600 text-gray-400 px-1 rounded">5天4夜</span>
                            </div>
                            <h3 class="font-bold text-lg mb-4 line-clamp-2">東京澀谷街頭龐克巡禮｜原宿系時尚探險・主題咖啡廳</h3>
                            <div class="flex items-center justify-between">
                                <span class="text-gray-500 line-through text-sm">$28,900</span>
                                <span class="text-k-pink font-bold text-xl">$24,500 <span
                                        class="text-xs text-gray-400">起</span></span>
                            </div>
                        </div>
                    </div>

                    <!-- Card 2 -->
                    <div class="bg-[#222] rounded-xl overflow-hidden card-hover cursor-pointer"
                        onclick="showDetail('london')">
                        <div class="relative h-48">
                            <img src="https://images.unsplash.com/photo-1517935706615-2717063c2225?q=80&w=1965&auto=format&fit=crop"
                                alt="London" class="w-full h-full object-cover opacity-80">
                            <div
                                class="absolute top-2 right-2 bg-purple-600 text-white text-xs px-2 py-1 rounded font-bold">
                                保證出團</div>
                        </div>
                        <div class="p-4">
                            <div class="flex gap-2 mb-2">
                                <span class="text-[10px] border border-[#9B72AA] text-[#9B72AA] px-1 rounded">倫敦</span>
                                <span class="text-[10px] border border-gray-600 text-gray-400 px-1 rounded">8天7夜</span>
                            </div>
                            <h3 class="font-bold text-lg mb-4 line-clamp-2">倫敦地下音樂聖地朝聖｜Camden Town 市集挖寶・歌德建築</h3>
                            <div class="flex items-center justify-between">
                                <span class="text-gray-500 line-through text-sm">$68,900</span>
                                <span class="text-k-pink font-bold text-xl">$62,000 <span
                                        class="text-xs text-gray-400">起</span></span>
                            </div>
                        </div>
                    </div>

                    <!-- Card 3 -->
                    <div class="bg-[#222] rounded-xl overflow-hidden card-hover cursor-pointer"
                        onclick="showDetail('kyoto')">
                        <div class="relative h-48">
                            <img src="https://images.unsplash.com/photo-1493976040374-85c8e12f0c0e?q=80&w=2070&auto=format&fit=crop"
                                alt="Kyoto" class="w-full h-full object-cover opacity-80">
                        </div>
                        <div class="p-4">
                            <div class="flex gap-2 mb-2">
                                <span class="text-[10px] border border-[#9B72AA] text-[#9B72AA] px-1 rounded">京都</span>
                                <span class="text-[10px] border border-gray-600 text-gray-400 px-1 rounded">5天4夜</span>
                            </div>
                            <h3 class="font-bold text-lg mb-4 line-clamp-2">京都夜行百鬼夜行特別企劃｜古寺探險・和服體驗</h3>
                            <div class="flex items-center justify-between">
                                <span class="text-gray-500 line-through text-sm">$32,000</span>
                                <span class="text-k-pink font-bold text-xl">$29,999 <span
                                        class="text-xs text-gray-400">起</span></span>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- Additional Hot Deals -->
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mt-6">
                    <!-- Card 4: Seoul -->
                    <div class="bg-[#222] rounded-xl overflow-hidden card-hover cursor-pointer"
                        onclick="showDetail('seoul')">
                        <div class="relative h-48">
                            <img src="https://images.unsplash.com/photo-1538485399081-7191377e8241?q=80&w=1974&auto=format&fit=crop"
                                alt="Seoul" class="w-full h-full object-cover opacity-80">
                            <div
                                class="absolute top-2 right-2 bg-k-pink text-white text-xs px-2 py-1 rounded font-bold">
                                熱銷</div>
                        </div>
                        <div class="p-4">
                            <div class="flex gap-2 mb-2">
                                <span class="text-[10px] border border-[#9B72AA] text-[#9B72AA] px-1 rounded">首爾</span>
                                <span class="text-[10px] border border-gray-600 text-gray-400 px-1 rounded">5天4夜</span>
                            </div>
                            <h3 class="font-bold text-lg mb-4 line-clamp-2">首爾弘大暗黑時尚｜哥德式咖啡廳・地下樂團巡演</h3>
                            <div class="flex items-center justify-between">
                                <span class="text-gray-500 line-through text-sm">$22,000</span>
                                <span class="text-k-pink font-bold text-xl">$18,900 <span
                                        class="text-xs text-gray-400">起</span></span>
                            </div>
                        </div>
                    </div>

                    <!-- Card 5: Bangkok -->
                    <div class="bg-[#222] rounded-xl overflow-hidden card-hover cursor-pointer"
                        onclick="showDetail('bangkok')">
                        <div class="relative h-48">
                            <img src="https://images.unsplash.com/photo-1508009603885-50cf7c579365?q=80&w=1950&auto=format&fit=crop"
                                alt="Bangkok" class="w-full h-full object-cover opacity-80">
                        </div>
                        <div class="p-4">
                            <div class="flex gap-2 mb-2">
                                <span class="text-[10px] border border-[#9B72AA] text-[#9B72AA] px-1 rounded">曼谷</span>
                                <span class="text-[10px] border border-gray-600 text-gray-400 px-1 rounded">6天5夜</span>
                            </div>
                            <h3 class="font-bold text-lg mb-4 line-clamp-2">曼谷午夜市集狂歡｜高空酒吧・霓虹夜生活</h3>
                            <div class="flex items-center justify-between">
                                <span class="text-gray-500 line-through text-sm">$18,000</span>
                                <span class="text-k-pink font-bold text-xl">$15,500 <span
                                        class="text-xs text-gray-400">起</span></span>
                            </div>
                        </div>
                    </div>

                    <!-- Card 6: Berlin -->
                    <div class="bg-[#222] rounded-xl overflow-hidden card-hover cursor-pointer"
                        onclick="showDetail('berlin')">
                        <div class="relative h-48">
                            <img src="https://images.unsplash.com/photo-1599946347371-68eb71b16afc?q=80&w=2070&auto=format&fit=crop"
                                alt="Berlin" class="w-full h-full object-cover opacity-80">
                            <div
                                class="absolute top-2 right-2 bg-purple-600 text-white text-xs px-2 py-1 rounded font-bold">
                                獨家</div>
                        </div>
                        <div class="p-4">
                            <div class="flex gap-2 mb-2">
                                <span class="text-[10px] border border-[#9B72AA] text-[#9B72AA] px-1 rounded">柏林</span>
                                <span class="text-[10px] border border-gray-600 text-gray-400 px-1 rounded">9天8夜</span>
                            </div>
                            <h3 class="font-bold text-lg mb-4 line-clamp-2">柏林地下電音聖殿｜廢墟塗鴉藝術・Techno 派對</h3>
                            <div class="flex items-center justify-between">
                                <span class="text-gray-500 line-through text-sm">$60,000</span>
                                <span class="text-k-pink font-bold text-xl">$55,000 <span
                                        class="text-xs text-gray-400">起</span></span>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- Additional Hot Deals -->
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mt-6">
                    <!-- Card 4: Paris -->
                    <div class="bg-[#222] rounded-xl overflow-hidden card-hover cursor-pointer"
                        onclick="showDetail('paris')">
                        <div class="relative h-48">
                            <img src="https://images.unsplash.com/photo-1502602898657-3e91760cbb34?q=80&w=2073&auto=format&fit=crop"
                                alt="Paris" class="w-full h-full object-cover opacity-80">
                            <div
                                class="absolute top-2 right-2 bg-k-pink text-white text-xs px-2 py-1 rounded font-bold">
                                熱銷</div>
                        </div>
                        <div class="p-4">
                            <div class="flex gap-2 mb-2">
                                <span class="text-[10px] border border-[#9B72AA] text-[#9B72AA] px-1 rounded">巴黎</span>
                                <span class="text-[10px] border border-gray-600 text-gray-400 px-1 rounded">7天6夜</span>
                            </div>
                            <h3 class="font-bold text-lg mb-4 line-clamp-2">巴黎地下墓穴探險｜歌德式教堂巡禮・蒙馬特藝術</h3>
                            <div class="flex items-center justify-between">
                                <span class="text-gray-500 line-through text-sm">$58,000</span>
                                <span class="text-k-pink font-bold text-xl">$52,900 <span
                                        class="text-xs text-gray-400">起</span></span>
                            </div>
                        </div>
                    </div>

                    <!-- Card 5: NYC -->
                    <div class="bg-[#222] rounded-xl overflow-hidden card-hover cursor-pointer"
                        onclick="showDetail('nyc')">
                        <div class="relative h-48">
                            <img src="https://images.unsplash.com/photo-1496442226666-8d4a0e62e6e9?q=80&w=2070&auto=format&fit=crop"
                                alt="NYC" class="w-full h-full object-cover opacity-80">
                        </div>
                        <div class="p-4">
                            <div class="flex gap-2 mb-2">
                                <span class="text-[10px] border border-[#9B72AA] text-[#9B72AA] px-1 rounded">紐約</span>
                                <span class="text-[10px] border border-gray-600 text-gray-400 px-1 rounded">8天7夜</span>
                            </div>
                            <h3 class="font-bold text-lg mb-4 line-clamp-2">紐約東村龐克搖滾｜CBGB舊址朝聖・布魯克林地下藝術</h3>
                            <div class="flex items-center justify-between">
                                <span class="text-gray-500 line-through text-sm">$75,000</span>
                                <span class="text-k-pink font-bold text-xl">$68,800 <span
                                        class="text-xs text-gray-400">起</span></span>
                            </div>
                        </div>
                    </div>

                    <!-- Card 6: Taipei -->
                    <div class="bg-[#222] rounded-xl overflow-hidden card-hover cursor-pointer"
                        onclick="showDetail('taipei')">
                        <div class="relative h-48">
                            <img src="https://images.unsplash.com/photo-1552422554-0d5af0a7a968?q=80&w=2070&auto=format&fit=crop"
                                alt="Taipei" class="w-full h-full object-cover opacity-80">
                            <div
                                class="absolute top-2 right-2 bg-purple-600 text-white text-xs px-2 py-1 rounded font-bold">
                                獨家</div>
                        </div>
                        <div class="p-4">
                            <div class="flex gap-2 mb-2">
                                <span class="text-[10px] border border-[#9B72AA] text-[#9B72AA] px-1 rounded">台北</span>
                                <span class="text-[10px] border border-gray-600 text-gray-400 px-1 rounded">3天2夜</span>
                            </div>
                            <h3 class="font-bold text-lg mb-4 line-clamp-2">台北西門町次文化｜刺青街巡禮・Live House 體驗</h3>
                            <div class="flex items-center justify-between">
                                <span class="text-gray-500 line-through text-sm">$8,000</span>
                                <span class="text-k-pink font-bold text-xl">$6,666 <span
                                        class="text-xs text-gray-400">起</span></span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- 2. SEARCH RESULT PAGE -->
        <section id="search" class="page-section">
            <div class="bg-[#222] py-4 border-b border-[#3E204F]">
                <div class="container mx-auto px-4">
                    <p class="text-gray-400 text-sm"><a href="#" onclick="router('home')"
                            class="hover:text-k-pink">首頁</a> > <span class="text-white">日本旅遊</span></p>
                </div>
            </div>

            <div class="container mx-auto px-4 py-8 flex flex-col md:flex-row gap-8">
                <!-- Sidebar Filters -->
                <aside class="w-full md:w-1/4">
                    <div class="bg-[#222] rounded-lg p-6 border border-gray-700 sticky top-20">
                        <h3 class="font-bold text-lg mb-4 flex items-center"><i
                                class="fa-solid fa-filter mr-2 text-k-pink"></i> 篩選條件</h3>

                        <!-- Filter Group -->
                        <div class="mb-6">
                            <h4 class="text-sm font-bold text-gray-300 mb-3">價格範圍</h4>
                            <div class="space-y-2">
                                <label class="flex items-center text-sm text-gray-400 cursor-pointer hover:text-white">
                                    <input type="checkbox" class="mr-2 accent-pink-500 filter-price" value="low">
                                    $20,000 以下
                                </label>
                                <label class="flex items-center text-sm text-gray-400 cursor-pointer hover:text-white">
                                    <input type="checkbox" class="mr-2 accent-pink-500 filter-price" value="mid"
                                        checked> $20,000 - $40,000
                                </label>
                                <label class="flex items-center text-sm text-gray-400 cursor-pointer hover:text-white">
                                    <input type="checkbox" class="mr-2 accent-pink-500 filter-price" value="high">
                                    $40,000 以上
                                </label>
                            </div>
                        </div>

                        <div class="mb-6">
                            <h4 class="text-sm font-bold text-gray-300 mb-3">旅遊主題</h4>
                            <div class="space-y-2">
                                <label class="flex items-center text-sm text-gray-400 cursor-pointer hover:text-white">
                                    <input type="checkbox" class="mr-2 accent-pink-500 filter-theme" value="shopping"
                                        checked> 潮流購物
                                </label>
                                <label class="flex items-center text-sm text-gray-400 cursor-pointer hover:text-white">
                                    <input type="checkbox" class="mr-2 accent-pink-500 filter-theme" value="history">
                                    歷史文化
                                </label>
                                <label class="flex items-center text-sm text-gray-400 cursor-pointer hover:text-white">
                                    <input type="checkbox" class="mr-2 accent-pink-500 filter-theme" value="theme-park">
                                    主題樂園
                                </label>
                            </div>
                        </div>

                        <button class="w-full btn-primary py-2 rounded text-sm" onclick="applyFilters()">套用篩選</button>
                    </div>
                </aside>

                <!-- Product List -->
                <div class="w-full md:w-3/4 space-y-4">
                    <div class="flex justify-between items-center mb-4">
                        <h2 id="search-results-title" class="text-xl font-bold">搜尋結果：共 3 筆行程</h2>
                        <select id="sort-select" class="bg-[#222] border border-gray-600 text-sm p-1 rounded"
                            onchange="applyFilters()">
                            <option value="price-asc">價格由低到高</option>
                            <option value="price-desc">價格由高到低</option>
                            <option value="popularity">熱門程度</option>
                        </select>
                    </div>

                    <!-- Dynamic Results Container -->
                    <div id="search-results-container">
                        <!-- Default static content will be replaced by JS if searching flights -->

                        <!-- List Item 1: Tokyo -->
                        <div class="bg-[#222] rounded-lg overflow-hidden flex flex-col md:flex-row border border-transparent hover:border-[#9B72AA] transition group cursor-pointer mb-4"
                            onclick="showDetail('tokyo')">
                            <div class="w-full md:w-1/3 h-48 md:h-auto relative">
                                <img src="https://images.unsplash.com/photo-1540959733332-eab4deabeeaf?q=80&w=1994&auto=format&fit=crop"
                                    class="w-full h-full object-cover">
                                <div
                                    class="absolute top-0 left-0 bg-k-pink text-white text-xs px-2 py-1 rounded-br-lg font-bold">
                                    熱銷</div>
                            </div>
                            <div class="p-4 w-full md:w-2/3 flex flex-col justify-between">
                                <div>
                                    <h3 class="text-xl font-bold mb-2 group-hover:text-k-pink transition">
                                        東京澀谷街頭龐克巡禮｜原宿系時尚探險・主題咖啡廳</h3>
                                    <div class="flex flex-wrap gap-2 mb-2">
                                        <span class="text-xs bg-[#333] text-gray-300 px-2 py-1 rounded">成田進出</span>
                                        <span class="text-xs bg-[#333] text-gray-300 px-2 py-1 rounded">市區住宿</span>
                                    </div>
                                    <p class="text-sm text-gray-400 line-clamp-2">
                                        深入探索東京次文化聖地，拜訪庫洛米風格小店，入住新宿精選飯店，體驗最道地的日本潮流文化。</p>
                                </div>
                                <div class="flex justify-between items-end mt-4">
                                    <div class="text-sm text-gray-500">可售日期: 11/25, 12/02, 12/10</div>
                                    <div class="text-right">
                                        <div class="text-gray-500 line-through text-sm">$28,900</div>
                                        <div class="text-k-pink font-bold text-2xl">$24,500</div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- List Item 2: Osaka -->
                        <div class="bg-[#222] rounded-lg overflow-hidden flex flex-col md:flex-row border border-transparent hover:border-[#9B72AA] transition group cursor-pointer mb-4"
                            onclick="showDetail('osaka')">
                            <div class="w-full md:w-1/3 h-48 md:h-auto relative">
                                <img src="https://images.unsplash.com/photo-1524024926029-b31379629e36?q=80&w=1932&auto=format&fit=crop"
                                    class="w-full h-full object-cover">
                            </div>
                            <div class="p-4 w-full md:w-2/3 flex flex-col justify-between">
                                <div>
                                    <h3 class="text-xl font-bold mb-2 group-hover:text-k-pink transition">
                                        大阪黑門市場美食與環球影城｜庫洛米特別企劃</h3>
                                    <div class="flex flex-wrap gap-2 mb-2">
                                        <span class="text-xs bg-[#333] text-gray-300 px-2 py-1 rounded">USJ門票</span>
                                        <span class="text-xs bg-[#333] text-gray-300 px-2 py-1 rounded">含快速通關</span>
                                    </div>
                                    <p class="text-sm text-gray-400 line-clamp-2">全日暢遊大阪環球影城，尋找限定周邊商品，晚間前往道頓堀享受美食饗宴。</p>
                                </div>
                                <div class="flex justify-between items-end mt-4">
                                    <div class="text-sm text-gray-500">可售日期: 12/05, 12/12, 12/20</div>
                                    <div class="text-right">
                                        <div class="text-gray-500 line-through text-sm">$35,000</div>
                                        <div class="text-k-pink font-bold text-2xl">$32,800</div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- List Item 3: Seoul -->
                        <div class="bg-[#222] rounded-lg overflow-hidden flex flex-col md:flex-row border border-transparent hover:border-[#9B72AA] transition group cursor-pointer mb-4"
                            onclick="showDetail('seoul')">
                            <div class="w-full md:w-1/3 h-48 md:h-auto relative">
                                <img src="https://images.unsplash.com/photo-1538485399081-7191377e8241?q=80&w=1974&auto=format&fit=crop"
                                    class="w-full h-full object-cover">
                            </div>
                            <div class="p-4 w-full md:w-2/3 flex flex-col justify-between">
                                <div>
                                    <h3 class="text-xl font-bold mb-2 group-hover:text-k-pink transition">
                                        首爾弘大暗黑時尚｜哥德式咖啡廳・地下樂團巡演</h3>
                                    <div class="flex flex-wrap gap-2 mb-2">
                                        <span class="text-xs bg-[#333] text-gray-300 px-2 py-1 rounded">仁川進出</span>
                                        <span class="text-xs bg-[#333] text-gray-300 px-2 py-1 rounded">弘大住宿</span>
                                    </div>
                                    <p class="text-sm text-gray-400 line-clamp-2">探索首爾年輕人的次文化中心，造訪風格獨特的咖啡廳與Live
                                        House，感受韓流之外的地下脈動。</p>
                                </div>
                                <div class="flex justify-between items-end mt-4">
                                    <div class="text-sm text-gray-500">可售日期: 01/10, 01/17, 01/24</div>
                                    <div class="text-right">
                                        <div class="text-gray-500 line-through text-sm">$22,000</div>
                                        <div class="text-k-pink font-bold text-2xl">$18,900</div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- List Item 4: Bangkok -->
                        <div class="bg-[#222] rounded-lg overflow-hidden flex flex-col md:flex-row border border-transparent hover:border-[#9B72AA] transition group cursor-pointer mb-4"
                            onclick="showDetail('bangkok')">
                            <div class="w-full md:w-1/3 h-48 md:h-auto relative">
                                <img src="https://images.unsplash.com/photo-1508009603885-50cf7c579365?q=80&w=1950&auto=format&fit=crop"
                                    class="w-full h-full object-cover">
                            </div>
                            <div class="p-4 w-full md:w-2/3 flex flex-col justify-between">
                                <div>
                                    <h3 class="text-xl font-bold mb-2 group-hover:text-k-pink transition">
                                        曼谷午夜市集狂歡｜高空酒吧・霓虹夜生活</h3>
                                    <div class="flex flex-wrap gap-2 mb-2">
                                        <span class="text-xs bg-[#333] text-gray-300 px-2 py-1 rounded">BKK進出</span>
                                        <span class="text-xs bg-[#333] text-gray-300 px-2 py-1 rounded">五星飯店</span>
                                    </div>
                                    <p class="text-sm text-gray-400 line-clamp-2">體驗曼谷不夜城的魅力，從熱鬧的夜市到奢華的高空酒吧，享受泰式按摩與美食。
                                    </p>
                                </div>
                                <div class="flex justify-between items-end mt-4">
                                    <div class="text-sm text-gray-500">可售日期: 02/05, 02/12, 02/19</div>
                                    <div class="text-right">
                                        <div class="text-gray-500 line-through text-sm">$18,000</div>
                                        <div class="text-k-pink font-bold text-2xl">$15,500</div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- List Item 5: Berlin -->
                        <div class="bg-[#222] rounded-lg overflow-hidden flex flex-col md:flex-row border border-transparent hover:border-[#9B72AA] transition group cursor-pointer mb-4"
                            onclick="showDetail('berlin')">
                            <div class="w-full md:w-1/3 h-48 md:h-auto relative">
                                <img src="https://images.unsplash.com/photo-1599946347371-68eb71b16afc?q=80&w=2070&auto=format&fit=crop"
                                    class="w-full h-full object-cover">
                            </div>
                            <div class="p-4 w-full md:w-2/3 flex flex-col justify-between">
                                <div>
                                    <h3 class="text-xl font-bold mb-2 group-hover:text-k-pink transition">
                                        柏林地下電音聖殿｜廢墟塗鴉藝術・Techno 派對</h3>
                                    <div class="flex flex-wrap gap-2 mb-2">
                                        <span class="text-xs bg-[#333] text-gray-300 px-2 py-1 rounded">柏林進出</span>
                                        <span class="text-xs bg-[#333] text-gray-300 px-2 py-1 rounded">特色旅宿</span>
                                    </div>
                                    <p class="text-sm text-gray-400 line-clamp-2">朝聖世界Techno首都，探索冷戰歷史遺跡與現代街頭藝術的完美融合。</p>
                                </div>
                                <div class="flex justify-between items-end mt-4">
                                    <div class="text-sm text-gray-500">可售日期: 03/10, 03/20, 03/30</div>
                                    <div class="text-right">
                                        <div class="text-gray-500 line-through text-sm">$60,000</div>
                                        <div class="text-k-pink font-bold text-2xl">$55,000</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="text-sm text-gray-500">可售日期: 01/15, 01/20</div>
                        <div class="text-right">
                            <div class="text-gray-500 line-through text-sm">$35,000</div>
                            <div class="text-k-pink font-bold text-2xl">$32,800</div>
                        </div>
                    </div>
                </div>
            </div>

            </div>
            </div>
        </section>



        <!-- 3. PRODUCT DETAIL PAGE -->
        <!-- 7. FLIGHT RESULTS PAGE -->
        <section id="flight-results" class="page-section">
            <div class="bg-[#222] py-4 border-b border-[#3E204F]">
                <div class="container mx-auto px-4">
                    <p class="text-gray-400 text-sm"><a href="#" onclick="router('home')"
                            class="hover:text-k-pink">首頁</a> > <span class="text-white">機票搜尋結果</span></p>
                </div>
            </div>

            <div class="container mx-auto px-4 py-8">
                <h2 class="text-3xl font-bold mb-6" id="flight-results-title">搜尋結果</h2>
                <div id="flight-list" class="space-y-4">
                    <!-- Dynamic Flight Cards -->
                </div>
            </div>
        </section>

        <!-- 8. FLIGHT BOOKING PAGE -->
        <section id="flight-booking" class="page-section">
            <div class="bg-[#222] py-4 border-b border-[#3E204F]">
                <div class="container mx-auto px-4">
                    <p class="text-gray-400 text-sm"><a href="#" onclick="router('home')"
                            class="hover:text-k-pink">首頁</a> > <a href="#" onclick="router('flight-results')"
                            class="hover:text-k-pink">機票搜尋</a> > <span class="text-white">機位選擇</span></p>
                </div>
            </div>
            <div class="container mx-auto px-4 py-8">
                <div class="flex flex-col lg:flex-row gap-8">
                    <!-- Left: Selection Area -->
                    <div class="w-full lg:w-2/3">
                        <!-- Step 1: Cabin -->
                        <div class="bg-[#222] rounded-xl p-6 mb-6 border border-gray-700">
                            <h3 class="text-xl font-bold mb-4 flex items-center"><i
                                    class="fa-solid fa-couch text-k-pink mr-3"></i> 選擇艙等</h3>
                            <div class="grid grid-cols-3 gap-4">
                                <button onclick="selectCabin('economy')" id="btn-economy"
                                    class="cabin-btn p-4 rounded border border-gray-600 hover:border-k-pink text-center active">
                                    <div class="font-bold">經濟艙</div>
                                    <div class="text-sm text-gray-400" id="price-economy"></div>
                                </button>
                                <button onclick="selectCabin('business')" id="btn-business"
                                    class="cabin-btn p-4 rounded border border-gray-600 hover:border-k-pink text-center">
                                    <div class="font-bold">商務艙</div>
                                    <div class="text-sm text-gray-400" id="price-business"></div>
                                </button>
                                <button onclick="selectCabin('first')" id="btn-first"
                                    class="cabin-btn p-4 rounded border border-gray-600 hover:border-k-pink text-center">
                                    <div class="font-bold">頭等艙</div>
                                    <div class="text-sm text-gray-400" id="price-first"></div>
                                </button>
                            </div>
                        </div>

                        <!-- Step 2: Seat Map -->
                        <div class="bg-[#222] rounded-xl p-6 mb-6 border border-gray-700">
                            <h3 class="text-xl font-bold mb-4 flex items-center"><i
                                    class="fa-solid fa-border-all text-k-pink mr-3"></i> 選擇座位</h3>
                            <div class="flex justify-center mb-4 gap-4 text-sm">
                                <div class="flex items-center">
                                    <div class="w-4 h-4 bg-gray-600 rounded mr-2"></div> 已佔用
                                </div>
                                <div class="flex items-center">
                                    <div class="w-4 h-4 bg-[#333] border border-gray-500 rounded mr-2"></div> 可選
                                </div>
                                <div class="flex items-center">
                                    <div class="w-4 h-4 bg-k-pink rounded mr-2"></div> 已選
                                </div>
                            </div>
                            <div id="seat-map" class="flex flex-col gap-2 items-center overflow-x-auto pb-4">
                                <!-- Dynamic Seat Grid -->
                            </div>
                        </div>

                        <!-- Step 3: Meal -->
                        <div class="bg-[#222] rounded-xl p-6 mb-6 border border-gray-700">
                            <h3 class="text-xl font-bold mb-4 flex items-center"><i
                                    class="fa-solid fa-utensils text-k-pink mr-3"></i> 選擇餐點</h3>
                            <select id="flight-meal"
                                class="w-full p-3 rounded bg-[#333] border border-gray-600 text-white">
                                <option value="standard">標準餐</option>
                                <option value="vegetarian">素食餐 (蛋奶素)</option>
                                <option value="vegan">全素餐</option>
                                <option value="halal">清真餐</option>
                                <option value="child">兒童餐</option>
                                <option value="fruit">水果餐</option>
                            </select>
                        </div>
                    </div>

                    <!-- Right: Summary -->
                    <div class="w-full lg:w-1/3">
                        <div class="bg-[#222] rounded-xl p-6 sticky top-24 border border-[#3E204F] shadow-2xl">
                            <h3 class="text-xl font-bold mb-4">行程摘要</h3>
                            <div id="booking-summary-content" class="space-y-4 mb-6 text-sm text-gray-300">
                                <!-- Dynamic Content -->
                            </div>
                            <div class="border-t border-gray-700 pt-4 mb-6">
                                <div class="flex justify-between items-center">
                                    <span class="font-bold">總金額</span>
                                    <span id="flight-total-price" class="text-3xl font-black text-k-pink"></span>
                                </div>
                            </div>
                            <button onclick="confirmFlightBooking()"
                                class="w-full btn-primary py-4 rounded-lg font-bold text-xl mb-2">確認訂位</button>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- 9. HOTEL RESULTS PAGE -->
        <section id="hotel-results" class="page-section">
            <div class="bg-[#222] py-4 border-b border-[#3E204F]">
                <div class="container mx-auto px-4">
                    <p class="text-gray-400 text-sm"><a href="#" onclick="router('home')"
                            class="hover:text-k-pink">首頁</a> > <span class="text-white">訂房搜尋結果</span></p>
                </div>
            </div>

            <div class="container mx-auto px-4 py-8">
                <h2 class="text-3xl font-bold mb-6" id="hotel-results-title">搜尋結果</h2>
                <div id="hotel-list" class="space-y-4">
                    <!-- Dynamic Hotel Cards -->
                </div>
            </div>
        </section>

        <!-- 10. HOTEL BOOKING PAGE -->
        <section id="hotel-booking" class="page-section">
            <div class="bg-[#222] py-4 border-b border-[#3E204F]">
                <div class="container mx-auto px-4">
                    <p class="text-gray-400 text-sm"><a href="#" onclick="router('home')"
                            class="hover:text-k-pink">首頁</a> > <a href="#" onclick="router('hotel-results')"
                            class="hover:text-k-pink">訂房搜尋</a> > <span class="text-white">確認訂房</span></p>
                </div>
            </div>
            <div class="container mx-auto px-4 py-8">
                <div class="flex flex-col lg:flex-row gap-8">
                    <!-- Left: Details -->
                    <div class="w-full lg:w-2/3">
                        <div class="bg-[#222] rounded-xl p-6 mb-6 border border-gray-700">
                            <h3 class="text-xl font-bold mb-4 text-k-pink" id="booking-hotel-name"></h3>
                            <div class="flex gap-4 mb-4 text-sm text-gray-400">
                                <span id="booking-hotel-country"></span>
                                <span class="text-gray-600">|</span>
                                <span id="booking-room-type"></span>
                            </div>
                            <div class="grid grid-cols-2 gap-4 mb-4">
                                <div class="bg-[#333] p-3 rounded">
                                    <div class="text-xs text-gray-500 mb-1">入住日期</div>
                                    <div class="font-bold">2023/12/20</div>
                                </div>
                                <div class="bg-[#333] p-3 rounded">
                                    <div class="text-xs text-gray-500 mb-1">退房日期</div>
                                    <div class="font-bold">2023/12/24 (4晚)</div>
                                </div>
                            </div>
                            <div class="space-y-2">
                                <div class="flex items-center gap-2 text-sm text-gray-300">
                                    <i class="fa-solid fa-check text-k-pink"></i> <span id="booking-has-bathtub"></span>
                                </div>
                                <div class="flex items-center gap-2 text-sm text-gray-300">
                                    <i class="fa-solid fa-check text-k-pink"></i> <span
                                        id="booking-has-breakfast"></span>
                                </div>
                            </div>
                        </div>

                        <!-- Guest Info -->
                        <div class="bg-[#222] rounded-xl p-6 mb-6 border border-gray-700">
                            <h3 class="text-xl font-bold mb-4">住客資料</h3>
                            <div class="grid grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-sm text-gray-400 mb-1">姓名</label>
                                    <input type="text" class="w-full p-2 rounded bg-[#333] border border-gray-600"
                                        value="庫洛米">
                                </div>
                                <div>
                                    <label class="block text-sm text-gray-400 mb-1">電話</label>
                                    <input type="tel" class="w-full p-2 rounded bg-[#333] border border-gray-600"
                                        value="0912-345-678">
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Right: Summary -->
                    <div class="w-full lg:w-1/3">
                        <div class="bg-[#222] rounded-xl p-6 sticky top-24 border border-[#3E204F] shadow-2xl">
                            <h3 class="text-xl font-bold mb-4">費用明細</h3>
                            <div class="space-y-3 mb-6 text-sm text-gray-300">
                                <div class="flex justify-between">
                                    <span>房費 (4晚)</span>
                                    <span id="booking-room-price"></span>
                                </div>
                                <div class="flex justify-between">
                                    <span>稅金 & 服務費</span>
                                    <span>$2,500</span>
                                </div>
                            </div>
                            <div class="border-t border-gray-700 pt-4 mb-6">
                                <div class="flex justify-between items-center">
                                    <span class="font-bold">總金額</span>
                                    <span id="booking-total-price" class="text-3xl font-black text-k-pink"></span>
                                </div>
                            </div>
                            <button onclick="confirmHotelBooking()"
                                class="w-full btn-primary py-4 rounded-lg font-bold text-xl mb-2">確認訂房</button>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- 11. PRODUCT DETAIL PAGE -->
        <section id="detail" class="page-section">
            <!-- Breadcrumb -->
            <div class="bg-[#222] py-4 border-b border-[#3E204F]">
                <div class="container mx-auto px-4">
                    <p class="text-gray-400 text-sm"><a href="#" onclick="router('home')"
                            class="hover:text-k-pink">首頁</a> > <a href="#" onclick="router('search')"
                            class="hover:text-k-pink">日本旅遊</a> > <span class="text-white">東京龐克巡禮</span></p>
                </div>
            </div>

            <div class="container mx-auto px-4 py-8">
                <div class="flex flex-col lg:flex-row gap-8">
                    <!-- Left Content -->
                    <div class="w-full lg:w-2/3">
                        <h1 class="text-3xl font-bold mb-4 text-white leading-tight">東京澀谷街頭龐克巡禮｜原宿系時尚探險・主題咖啡廳・5日
                        </h1>
                        <div class="flex gap-3 mb-6">
                            <span class="bg-k-purple text-white px-3 py-1 rounded text-sm">無購物</span>
                            <span class="bg-gray-700 text-white px-3 py-1 rounded text-sm">保證出團</span>
                            <span class="bg-gray-700 text-white px-3 py-1 rounded text-sm">桃園出發</span>
                        </div>

                        <!-- Main Image -->
                        <div class="rounded-xl overflow-hidden mb-8 h-[400px]">
                            <img src="https://images.unsplash.com/photo-1540959733332-eab4deabeeaf?q=80&w=1994&auto=format&fit=crop"
                                class="w-full h-full object-cover">
                        </div>

                        <!-- Tabs -->
                        <div class="border-b border-gray-700 mb-6">
                            <button class="px-6 py-3 text-k-pink border-b-2 border-k-pink font-bold">行程特色</button>
                            <button class="px-6 py-3 text-gray-400 hover:text-white">每日行程</button>
                            <button class="px-6 py-3 text-gray-400 hover:text-white">費用說明</button>
                        </div>

                        <!-- Itinerary -->
                        <div
                            class="space-y-8 relative before:absolute before:left-[19px] before:top-2 before:h-full before:w-0.5 before:bg-gray-700">

                            <div class="relative pl-12">
                                <div
                                    class="absolute left-0 top-1 w-10 h-10 bg-k-pink rounded-full flex items-center justify-center font-bold text-white border-4 border-[#1A1A1A] z-10">
                                    1</div>
                                <h3 class="text-xl font-bold text-k-accent-purple mb-2">Day 1: 台北 → 東京成田空港 → 新宿飯店
                                    Check-in</h3>
                                <div class="bg-[#222] p-4 rounded-lg text-gray-300">
                                    <p class="mb-2">集合於桃園國際機場，搭乘豪華客機飛往日本首都－東京。</p>
                                    <ul class="list-disc list-inside text-sm text-gray-400">
                                        <li>餐食：機上精緻套餐 / 方便遊玩敬請自理</li>
                                        <li>住宿：Shinjuku Prince Hotel 或同級</li>
                                    </ul>
                                </div>
                            </div>

                            <div class="relative pl-12">
                                <div
                                    class="absolute left-0 top-1 w-10 h-10 bg-[#333] rounded-full flex items-center justify-center font-bold text-white border-4 border-[#1A1A1A] z-10">
                                    2</div>
                                <h3 class="text-xl font-bold text-white mb-2">Day 2: 原宿竹下通探險 → 庫洛米主題咖啡廳 → 澀谷十字路口
                                </h3>
                                <div class="bg-[#222] p-4 rounded-lg text-gray-300">
                                    <p class="mb-2">今日前往年輕人的時尚聖地原宿，尋找最酷炫的龐克配件。</p>
                                    <div class="mt-2 grid grid-cols-2 gap-2">
                                        <img src="https://images.unsplash.com/photo-1536098561742-ca998e48cbcc?q=80&w=2036&auto=format&fit=crop"
                                            class="rounded h-24 w-full object-cover">
                                        <img src="https://images.unsplash.com/photo-1503899036084-c55cdd92a805?q=80&w=2070&auto=format&fit=crop"
                                            class="rounded h-24 w-full object-cover">
                                    </div>
                                </div>
                            </div>
                            <!-- More days would go here -->
                        </div>
                    </div>

                    <!-- Right Sticky Booking -->
                    <div class="w-full lg:w-1/3">
                        <div class="bg-[#222] rounded-xl p-6 sticky top-24 border border-[#3E204F] shadow-2xl">
                            <h3 class="text-xl font-bold mb-4">選擇出發日期</h3>
                            <div class="mb-4">
                                <select class="w-full p-3 rounded bg-[#333] border border-gray-600">
                                    <option>2023/11/25 (五) - $24,500</option>
                                    <option>2023/12/02 (五) - $25,500</option>
                                    <option>2023/12/10 (六) - $26,900</option>
                                </select>
                            </div>

                            <div class="flex justify-between items-center mb-2">
                                <span class="text-gray-400">成人</span>
                                <div class="flex items-center gap-3">
                                    <button class="w-8 h-8 rounded-full bg-[#444] hover:bg-gray-500">-</button>
                                    <span>2</span>
                                    <button class="w-8 h-8 rounded-full bg-[#444] hover:bg-gray-500">+</button>
                                </div>
                            </div>
                            <div class="flex justify-between items-center mb-6">
                                <span class="text-gray-400">兒童</span>
                                <div class="flex items-center gap-3">
                                    <button class="w-8 h-8 rounded-full bg-[#444] hover:bg-gray-500">-</button>
                                    <span>0</span>
                                    <button class="w-8 h-8 rounded-full bg-[#444] hover:bg-gray-500">+</button>
                                </div>
                            </div>

                            <div class="border-t border-gray-700 pt-4 mb-6">
                                <div class="flex justify-between items-center">
                                    <span class="font-bold">總金額</span>
                                    <span class="text-3xl font-black text-k-pink">$49,000</span>
                                </div>
                            </div>

                            <button onclick="router('checkout')"
                                class="w-full btn-primary py-4 rounded-lg font-bold text-xl mb-2">立即預訂</button>
                            <p class="text-xs text-center text-gray-500"><i
                                    class="fa-solid fa-check-circle text-green-500"></i> 即時確認機位</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- 4. CHECKOUT PAGE -->
        <section id="checkout" class="page-section">
            <!-- Empty Cart State -->
            <div id="empty-cart" class="container mx-auto px-4 py-16 max-w-3xl text-center hidden">
                <div class="mb-8">
                    <i class="fa-solid fa-shopping-cart text-6xl text-gray-600 mb-4"></i>
                    <h2 class="text-3xl font-bold mb-2">購物車是空的</h2>
                    <p class="text-gray-400">還沒有選擇任何行程、機票或飯店</p>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-8">
                    <button onclick="router('home'); switchSearchTab('flight')"
                        class="bg-[#222] hover:bg-[#333] border border-gray-700 hover:border-k-pink p-6 rounded-xl transition">
                        <i class="fa-solid fa-plane text-3xl text-k-pink mb-3"></i>
                        <h3 class="font-bold mb-2">尋找機票</h3>
                        <p class="text-sm text-gray-400">探索龐克風格航班</p>
                    </button>
                    <button onclick="router('home'); switchSearchTab('hotel')"
                        class="bg-[#222] hover:bg-[#333] border border-gray-700 hover:border-k-pink p-6 rounded-xl transition">
                        <i class="fa-solid fa-hotel text-3xl text-k-pink mb-3"></i>
                        <h3 class="font-bold mb-2">預訂飯店</h3>
                        <p class="text-sm text-gray-400">找尋獨特住宿</p>
                    </button>
                    <button onclick="router('search')"
                        class="bg-[#222] hover:bg-[#333] border border-gray-700 hover:border-k-pink p-6 rounded-xl transition">
                        <i class="fa-solid fa-users text-3xl text-k-pink mb-3"></i>
                        <h3 class="font-bold mb-2">團體行程</h3>
                        <p class="text-sm text-gray-400">叛逆之旅等你來</p>
                    </button>
                </div>

                <button onclick="router('home')" class="btn-primary px-8 py-3 rounded-lg font-bold">
                    <i class="fa-solid fa-home mr-2"></i>返回首頁
                </button>
            </div>

            <!-- Checkout Content (Hidden by default) -->
            <div id="checkout-content" class="container mx-auto px-4 py-8 max-w-4xl hidden">
                <h1 class="text-3xl font-bold mb-8 text-center">訂單結帳 <i class="fa-solid fa-pen-nib text-k-pink"></i>
                </h1>

                <div class="flex flex-col md:flex-row gap-8">
                    <!-- Form -->
                    <div class="w-full md:w-2/3 space-y-6">
                        <!-- Order Info -->
                        <div class="bg-[#222] p-6 rounded-lg border-l-4 border-k-pink">
                            <h3 class="font-bold text-xl mb-4">訂購人資料</h3>
                            <div class="grid grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-sm text-gray-400 mb-1">姓名</label>
                                    <input type="text" id="checkout-name" class="w-full p-2 rounded bg-[#333]"
                                        value="庫洛米">
                                </div>
                                <div>
                                    <label class="block text-sm text-gray-400 mb-1">手機號碼</label>
                                    <input type="tel" id="checkout-phone" class="w-full p-2 rounded bg-[#333]"
                                        value="0912-345-678">
                                </div>
                                <div class="col-span-2">
                                    <label class="block text-sm text-gray-400 mb-1">電子信箱</label>
                                    <input type="email" id="checkout-email" class="w-full p-2 rounded bg-[#333]"
                                        value="kuromi@example.com">
                                </div>
                            </div>
                        </div>

                        <!-- Payment -->
                        <div class="bg-[#222] p-6 rounded-lg">
                            <h3 class="font-bold text-xl mb-4">付款方式</h3>
                            <div class="space-y-3">
                                <label
                                    class="flex items-center p-3 border border-gray-700 rounded cursor-pointer hover:border-k-pink">
                                    <input type="radio" name="payment" class="mr-3 accent-pink-500" checked>
                                    <span>信用卡一次付清</span> <i
                                        class="fa-brands fa-cc-visa ml-auto text-xl text-gray-400"></i>
                                </label>
                                <label
                                    class="flex items-center p-3 border border-gray-700 rounded cursor-pointer hover:border-k-pink">
                                    <input type="radio" name="payment" class="mr-3 accent-pink-500">
                                    <span>LINE Pay</span> <i
                                        class="fa-solid fa-comment-dollar ml-auto text-xl text-green-500"></i>
                                </label>
                            </div>
                        </div>

                        <button class="w-full btn-primary py-4 rounded-lg font-bold text-xl mt-4"
                            onclick="processPayment()">確認付款</button>
                    </div>

                    <!-- Summary -->
                    <div class="w-full md:w-1/3">
                        <div class="bg-[#2A2A2A] p-6 rounded-lg">
                            <h3 class="font-bold text-white mb-4 border-b border-gray-600 pb-2">訂單明細</h3>
                            <div id="order-summary">
                                <!-- Dynamic content will be inserted here -->
                            </div>
                            <div class="border-t border-gray-600 pt-4 flex justify-between items-center">
                                <span class="font-bold">總計</span>
                                <span id="order-total" class="text-2xl font-black text-k-pink">$0</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- 5. LOGIN PAGE (Modal Style) -->
        <section id="login" class="page-section">
            <div class="min-h-[80vh] flex items-center justify-center px-4">
                <div
                    class="bg-[#222] border-2 border-[#3E204F] p-8 rounded-2xl shadow-2xl max-w-md w-full relative overflow-hidden">
                    <!-- Deco -->
                    <div class="absolute -top-10 -right-10 text-9xl text-[#3E204F] opacity-20 transform rotate-12">
                        <i class="fa-solid fa-skull"></i>
                    </div>

                    <div class="text-center mb-8">
                        <div
                            class="w-16 h-16 bg-k-pink rounded-full flex items-center justify-center text-white text-2xl font-bold border-2 border-white mx-auto mb-4">
                            <i class="fa-solid fa-user-astronaut"></i>
                        </div>
                        <h2 class="text-2xl font-bold text-white">加入骷髏軍團</h2>
                        <p class="text-gray-400 text-sm">登入以解鎖更多叛逆行程</p>
                    </div>

                    <div class="space-y-4">
                        <div>
                            <input type="text" placeholder="帳號 / Email"
                                class="w-full p-3 rounded bg-[#1A1A1A] border border-gray-600 focus:border-k-pink text-white">
                        </div>
                        <div>
                            <input type="password" placeholder="密碼"
                                class="w-full p-3 rounded bg-[#1A1A1A] border border-gray-600 focus:border-k-pink text-white">
                        </div>
                        <button class="w-full btn-primary py-3 rounded font-bold" onclick="router('home')">登入</button>
                        <div class="text-center text-sm text-gray-500 mt-4">
                            還沒加入？ <a href="#" class="text-k-pink hover:underline">立即註冊</a>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- PAYMENT SUCCESS PAGE -->
        <section id="payment-success" class="page-section">
            <div class="container mx-auto px-4 py-16 max-w-3xl">
                <div class="text-center mb-12">
                    <div
                        class="w-24 h-24 bg-green-500 rounded-full flex items-center justify-center mx-auto mb-6 animate-bounce">
                        <i class="fa-solid fa-check text-white text-5xl"></i>
                    </div>
                    <h1 class="text-4xl font-bold mb-4">付款成功！</h1>
                    <p class="text-xl text-gray-400">庫洛米期待與你一起叛逆去旅行！</p>
                </div>

                <div class="bg-[#222] rounded-xl p-8 border border-gray-700 mb-8">
                    <h2 class="text-2xl font-bold mb-6 flex items-center">
                        <i class="fa-solid fa-ticket text-k-pink mr-3"></i> 訂單資訊
                    </h2>

                    <div class="space-y-4" id="success-booking-details">
                        <!-- Populated by JavaScript -->
                    </div>

                    <div class="border-t border-gray-700 mt-6 pt-6">
                        <div class="flex justify-between items-center mb-2">
                            <span class="text-gray-400">訂單編號</span>
                            <span class="font-bold" id="success-order-number"></span>
                        </div>
                        <div class="flex justify-between items-center mb-2">
                            <span class="text-gray-400">付款時間</span>
                            <span id="success-payment-time"></span>
                        </div>
                        <div class="flex justify-between items-center text-2xl font-bold mt-4">
                            <span>總金額</span>
                            <span class="text-k-pink" id="success-total-amount"></span>
                        </div>
                    </div>
                </div>

                <div class="bg-[#2A2A2A] rounded-xl p-6 mb-8">
                    <h3 class="font-bold mb-4 flex items-center">
                        <i class="fa-solid fa-info-circle text-blue-400 mr-2"></i> 重要提醒
                    </h3>
                    <ul class="space-y-2 text-sm text-gray-300">
                        <li><i class="fa-solid fa-envelope text-k-pink mr-2"></i> 確認信已發送至您的電子信箱</li>
                        <li><i class="fa-solid fa-calendar-check text-k-pink mr-2"></i> 請於出發前7天完成護照驗證</li>
                        <li><i class="fa-solid fa-phone text-k-pink mr-2"></i> 如有問題請聯繫客服：0800-666-888</li>
                    </ul>
                </div>

                <div class="flex gap-4">
                    <button onclick="router('home')"
                        class="flex-1 bg-[#333] hover:bg-[#444] text-white font-bold py-4 rounded-lg transition">
                        <i class="fa-solid fa-home mr-2"></i> 返回首頁
                    </button>
                    <button onclick="router('search')" class="flex-1 btn-primary py-4 rounded-lg font-bold">
                        <i class="fa-solid fa-search mr-2"></i> 繼續探索
                    </button>
                </div>
            </div>
        </section>

        <!-- 6. FAVORITES PAGE -->
        <section id="favorites" class="page-section">
            <div class="bg-[#222] py-4 border-b border-[#3E204F]">
                <div class="container mx-auto px-4">
                    <p class="text-gray-400 text-sm"><a href="#" onclick="router('home')"
                            class="hover:text-k-pink">首頁</a> > <span class="text-white">我的收藏</span></p>
                </div>
            </div>

            <div class="container mx-auto px-4 py-12">
                <h1 class="text-4xl font-bold mb-8 flex items-center">
                    <i class="fa-solid fa-heart text-k-pink mr-3"></i> 我的收藏
                </h1>

                <!-- Empty State -->
                <div id="favorites-empty" class="text-center py-20 hidden">
                    <i class="fa-regular fa-heart text-6xl text-gray-600 mb-4"></i>
                    <h2 class="text-2xl font-bold text-gray-400 mb-2">還沒有收藏的行程</h2>
                    <p class="text-gray-500 mb-6">快去找找你喜歡的叛逆之旅吧！</p>
                    <button onclick="router('search')" class="btn-primary px-6 py-3 rounded-lg">瀏覽行程</button>
                </div>

                <!-- Favorites Grid -->
                <div id="favorites-grid" class="grid grid-cols-1 md:grid-cols-3 gap-6">
                    <!-- Dynamically populated -->
                </div>
            </div>
        </section>

    </main>

    <!-- Oracle Modal -->
    <div id="oracle-modal">
        <div class="oracle-content">
            <button class="oracle-close" onclick="closeOracle()">
                <i class="fa-solid fa-times"></i>
            </button>

            <!-- Stage 1: Intro -->
            <div id="oracle-intro" class="oracle-stage active">
                <i class="fa-solid fa-skull text-6xl text-k-pink mb-4"></i>
                <h2 class="text-3xl font-bold mb-4">庫洛米的暗黑占卜</h2>
                <p class="text-gray-300 mb-8">不知道去哪裡釋放你的叛逆靈魂？<br>讓庫洛米用黑暗魔法為你指引方向...</p>
                <button class="btn-primary px-8 py-3 rounded-lg font-bold text-lg" onclick="startOracle()">開始占卜</button>
            </div>

            <!-- Stage 2: Question -->
            <div id="oracle-question" class="oracle-stage">
                <div class="mb-6">
                    <span class="text-k-pink text-sm font-bold" id="question-counter">Question 1/3</span>
                </div>
                <h3 class="text-2xl font-bold mb-8" id="question-text"></h3>
                <div id="question-options"></div>
            </div>

            <!-- Stage 3: Loading -->
            <div id="oracle-loading" class="oracle-stage">
                <i class="fa-solid fa-circle-notch fa-spin text-6xl text-k-pink mb-4"></i>
                <h3 class="text-2xl font-bold mb-4">正在召喚黑暗力量...</h3>
                <p class="text-gray-400">庫洛米正在為你尋找完美的叛逆之旅</p>
            </div>

            <!-- Stage 4: Result -->
            <div id="oracle-result" class="oracle-stage">
                <i class="fa-solid fa-heart text-4xl text-k-pink mb-4"></i>
                <h3 class="text-2xl font-bold mb-4">你的靈魂屬於...</h3>
                <h2 class="text-4xl font-black text-k-pink mb-6" id="result-destination"></h2>
                <img id="result-image" src="" class="w-full h-48 object-cover rounded-xl mb-6" alt="Destination">
                <p class="text-gray-300 mb-8" id="result-description"></p>
                <button class="btn-primary px-8 py-3 rounded-lg font-bold text-lg" id="result-btn"
                    onclick="">查看行程</button>
            </div>
        </div>
    </div>




    <!-- Airline Info Modal -->
    <div id="airline-modal" class="fixed inset-0 bg-black/90 z-[60] hidden items-center justify-center p-4">
        <div class="bg-[#222] rounded-xl max-w-lg w-full p-6 border border-k-pink relative">
            <button onclick="closeAirlineModal()" class="absolute top-4 right-4 text-gray-400 hover:text-white"><i
                    class="fa-solid fa-times text-xl"></i></button>
            <div class="text-center mb-6">
                <img id="modal-airline-logo" src="" class="h-16 mx-auto mb-4 object-contain bg-white rounded p-2">
                <h3 id="modal-airline-name" class="text-2xl font-bold text-white"></h3>
            </div>
            <p id="modal-airline-desc" class="text-gray-300 mb-6 leading-relaxed"></p>
            <div class="bg-[#1A1A1A] rounded p-4">
                <h4 class="font-bold text-k-pink mb-2">特色服務</h4>
                <ul id="modal-airline-features" class="list-disc list-inside text-gray-400 space-y-1"></ul>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="bg-[#111] border-t border-[#333] py-12 mt-auto">
        <div class="container mx-auto px-4">
            <div class="grid grid-cols-1 md:grid-cols-4 gap-8 mb-8">
                <div>
                    <div class="flex items-center space-x-2 mb-4">
                        <div
                            class="w-8 h-8 bg-k-pink rounded-full flex items-center justify-center text-white text-sm font-bold border border-white">
                            <i class="fa-solid fa-skull"></i>
                        </div>
                        <span class="text-xl font-black italic text-white">KUROMI<span
                                class="text-k-pink">TRAVEL</span></span>
                    </div>
                    <p class="text-gray-500 text-sm">我們不只是旅遊，是一種生活態度。跟隨庫洛米的腳步，探索世界的黑暗與美麗。</p>
                </div>
                <div>
                    <h4 class="font-bold text-white mb-4">關於我們</h4>
                    <ul class="space-y-2 text-sm text-gray-500">
                        <li><a href="#" class="hover:text-k-pink">品牌故事</a></li>
                        <li><a href="#" class="hover:text-k-pink">最新消息</a></li>
                        <li><a href="#" class="hover:text-k-pink">人才招募</a></li>
                    </ul>
                </div>
                <div>
                    <h4 class="font-bold text-white mb-4">顧客服務</h4>
                    <ul class="space-y-2 text-sm text-gray-500">
                        <li><a href="#" class="hover:text-k-pink">常見問題</a></li>
                        <li><a href="#" class="hover:text-k-pink">聯絡我們</a></li>
                        <li><a href="#" class="hover:text-k-pink">隱私權政策</a></li>
                    </ul>
                </div>
                <div>
                    <h4 class="font-bold text-white mb-4">追蹤我們</h4>
                    <div class="flex space-x-4">
                        <a href="#"
                            class="w-10 h-10 rounded bg-[#222] flex items-center justify-center text-gray-400 hover:bg-k-pink hover:text-white transition"><i
                                class="fa-brands fa-facebook-f"></i></a>
                        <a href="#"
                            class="w-10 h-10 rounded bg-[#222] flex items-center justify-center text-gray-400 hover:bg-k-pink hover:text-white transition"><i
                                class="fa-brands fa-instagram"></i></a>
                        <a href="#"
                            class="w-10 h-10 rounded bg-[#222] flex items-center justify-center text-gray-400 hover:bg-k-pink hover:text-white transition"><i
                                class="fa-brands fa-tiktok"></i></a>
                    </div>
                </div>
            </div>
            <div class="text-center text-xs text-gray-600 border-t border-[#222] pt-8">
                &copy; 2023 Kuromi Travel Inc. All rights reserved. Concept Design.
            </div>
        </div>
    </footer>

    <script>
        // Oracle Quiz Data
        const oracleQuestions = [
            {
                q: "今天的心情是？",
                options: [
                    { text: "想去陰森神秘的地方探險", type: "goth" },
                    { text: "想在街頭釋放叛逆能量", type: "punk" },
                    { text: "想徹夜狂歡不睡覺", type: "party" }
                ]
            },
            {
                q: "理想的旅伴是？",
                options: [
                    { text: "吸血鬼或哥德少女", type: "goth" },
                    { text: "搖滾樂手或刺青師", type: "punk" },
                    { text: "派對動物或夜店 DJ", type: "party" }
                ]
            },
            {
                q: "最想體驗的活動？",
                options: [
                    { text: "參觀地下墓穴或鬼屋", type: "goth" },
                    { text: "去 Live House 看演出", type: "punk" },
                    { text: "泡夜店或高空酒吧", type: "party" }
                ]
            }
        ];

        const oracleResults = {
            goth: {
                destinations: ['paris', 'london', 'kyoto'],
                title: "歌德暗黑系",
                desc: "你的靈魂渴望神秘與歷史，適合探索古老的建築與傳說。"
            },
            punk: {
                destinations: ['tokyo', 'berlin', 'nyc'],
                title: "龐克叛逆系",
                desc: "你充滿街頭能量，需要音樂、塗鴉與地下文化的洗禮。"
            },
            party: {
                destinations: ['bangkok', 'seoul', 'taipei'],
                title: "夜生活狂歡系",
                desc: "你是夜的王者，霓虹燈與派對是你的歸屬。"
            }
        };

        let currentQuestionIndex = 0;
        let oracleScores = { goth: 0, punk: 0, party: 0 };

        function openOracle() {
            document.getElementById('oracle-modal').classList.add('active');
            resetOracle();
        }

        function closeOracle() {
            document.getElementById('oracle-modal').classList.remove('active');
        }

        function resetOracle() {
            currentQuestionIndex = 0;
            oracleScores = { goth: 0, punk: 0, party: 0 };
            showStage('oracle-intro');
        }

        function showStage(stageId) {
            document.querySelectorAll('.oracle-stage').forEach(s => s.classList.remove('active'));
            document.getElementById(stageId).classList.add('active');
        }

        function startOracle() {
            showQuestion();
        }

        function showQuestion() {
            if (currentQuestionIndex >= oracleQuestions.length) {
                showLoading();
                return;
            }

            const question = oracleQuestions[currentQuestionIndex];
            document.getElementById('question-counter').innerText = `Question ${currentQuestionIndex + 1}/${oracleQuestions.length}`;
            document.getElementById('question-text').innerText = question.q;

            const optionsContainer = document.getElementById('question-options');
            optionsContainer.innerHTML = '';
            question.options.forEach(option => {
                const btn = document.createElement('button');
                btn.className = 'oracle-option-btn';
                btn.innerText = option.text;
                btn.onclick = () => answerOracle(option.type);
                optionsContainer.appendChild(btn);
            });

            showStage('oracle-question');
        }

        function answerOracle(type) {
            oracleScores[type]++;
            currentQuestionIndex++;
            showQuestion();
        }

        function showLoading() {
            showStage('oracle-loading');
            setTimeout(showResult, 2000);
        }

        function showResult() {
            // Find the type with highest score
            let maxType = 'punk';
            let maxScore = 0;
            for (const [type, score] of Object.entries(oracleScores)) {
                if (score > maxScore) {
                    maxScore = score;
                    maxType = type;
                }
            }

            const result = oracleResults[maxType];
            const destId = result.destinations[Math.floor(Math.random() * result.destinations.length)];
            const destData = itineraries[destId];

            document.getElementById('result-destination').innerText = result.title;
            document.getElementById('result-description').innerText = result.desc;
            document.getElementById('result-image').src = destData.image;
            document.getElementById('result-btn').onclick = () => {
                closeOracle();
                showDetail(destId);
            };

            showStage('oracle-result');
        }

        // ========== WISHLIST SYSTEM ==========
        let favorites = [];

        function loadFavorites() {
            const stored = localStorage.getItem('kuromi_favorites');
            favorites = stored ? JSON.parse(stored) : [];
            updateFavoriteUI();
        }

        function saveFavorites() {
            localStorage.setItem('kuromi_favorites', JSON.stringify(favorites));
        }

        function toggleFavorite(id) {
            const index = favorites.indexOf(id);
            if (index > -1) {
                favorites.splice(index, 1);
            } else {
                favorites.push(id);
            }
            saveFavorites();
            updateFavoriteUI();
        }

        function updateFavoriteUI() {
            // Update heart icons
            document.querySelectorAll('.wishlist-heart').forEach(heart => {
                const id = heart.getAttribute('data-id');
                const icon = heart.querySelector('i');
                if (favorites.includes(id)) {
                    icon.className = 'fa-solid fa-heart text-white text-xl';
                    heart.classList.add('favorited');
                } else {
                    icon.className = 'fa-regular fa-heart text-white text-xl';
                    heart.classList.remove('favorited');
                }
            });

            // Update counter
            const counter = document.getElementById('favorites-counter');
            if (favorites.length > 0) {
                counter.innerText = favorites.length;
                counter.classList.remove('hidden');
            } else {
                counter.classList.add('hidden');
            }
        }

        function renderFavoritesPage() {
            const grid = document.getElementById('favorites-grid');
            const empty = document.getElementById('favorites-empty');

            if (favorites.length === 0) {
                empty.classList.remove('hidden');
                grid.innerHTML = '';
                return;
            }

            empty.classList.add('hidden');
            grid.innerHTML = '';

            favorites.forEach(id => {
                const data = itineraries[id];
                if (!data) return;

                const card = `
                    <div class="bg-[#222] rounded-xl overflow-hidden card-hover cursor-pointer">
                        <div class="relative h-48" onclick="showDetail('${id}')">
                            <img src="${data.image}" class="w-full h-full object-cover opacity-80">
                            <div class="wishlist-heart favorited" onclick="event.stopPropagation(); toggleFavorite('${id}')" data-id="${id}">
                                <i class="fa-solid fa-heart text-white text-xl"></i>
                            </div>
                        </div>
                        <div class="p-4" onclick="showDetail('${id}')">
                            <h3 class="font-bold text-lg mb-2 line-clamp-2">${data.title}</h3>
                            <div class="flex items-center justify-between">
                                <span class="text-k-pink font-bold text-xl">${data.price}</span>
                            </div>
                        </div>
                    </div>
                `;
                grid.insertAdjacentHTML('beforeend', card);
            });

            updateFavoriteUI();
        }

        // ========== SCROLL ANIMATIONS ==========
        function initScrollAnimations() {
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        entry.target.classList.add('visible');
                    }
                });
            }, { threshold: 0.1 });

            document.querySelectorAll('.fade-in-up').forEach(el => observer.observe(el));
        }

        // ========== PARALLAX EFFECT ==========
        function initParallax() {
            const heroSection = document.querySelector('#home .relative.h-\\[500px\\]');
            if (!heroSection) return;

            window.addEventListener('scroll', () => {
                const scrolled = window.pageYOffset;
                const bgDiv = heroSection.querySelector('.absolute.inset-0.bg-\\[url');
                if (bgDiv && scrolled < 600) {
                    bgDiv.style.transform = `translateY(${scrolled * 0.5}px)`;
                }
            });
        }

        // ========== REVIEW DATA ==========
        const reviews = {
            'tokyo': [
                { name: "黑暗公主", avatar: "👸", rating: 5, rebelIndex: 9, comment: "超叛逆！原宿的地下文化太酷了，庫洛米精選果然不同凡響！", date: "2024-01" },
                { name: "龐克小子", avatar: "🎸", rating: 5, rebelIndex: 10, comment: "澀谷的夜晚簡直是搖滾聖地，五星推薦！", date: "2024-02" },
                { name: "暗黑少女", avatar: "🖤", rating: 4, rebelIndex: 8, comment: "咖啡廳很有特色，但希望有更多自由時間。", date: "2024-03" }
            ],
            'london': [
                { name: "哥德女王", avatar: "👑", rating: 5, rebelIndex: 10, comment: "Camden Town 太讚了！每個角落都是驚喜。", date: "2024-01" },
                { name: "搖滾魂", avatar: "🤘", rating: 5, rebelIndex: 9, comment: "音樂朝聖之旅，值得！", date: "2024-02" }
            ],
            'paris': [
                { name: "吸血鬼伯爵", avatar: "🧛", rating: 5, rebelIndex: 10, comment: "地下墓穴探險太刺激了！", date: "2024-01" }
            ],
            'berlin': [
                { name: "電音狂", avatar: "🎧", rating: 5, rebelIndex: 10, comment: "Techno 派對震撼靈魂！", date: "2024-02" }
            ]
        };

        function getAverageRating(id) {
            const cityReviews = reviews[id] || [];
            if (cityReviews.length === 0) return 0;
            const sum = cityReviews.reduce((acc, r) => acc + r.rating, 0);
            return (sum / cityReviews.length).toFixed(1);
        }

        function getAverageRebelIndex(id) {
            const cityReviews = reviews[id] || [];
            if (cityReviews.length === 0) return 0;
            const sum = cityReviews.reduce((acc, r) => acc + r.rebelIndex, 0);
            return Math.round(sum / cityReviews.length);
        }

        // Itinerary Data
        let itineraries = {
            'tokyo': {
                title: '東京澀谷街頭龐克巡禮｜原宿系時尚探險・主題咖啡廳・5日',
                price: '$24,500',
                originalPrice: '$28,900',
                image: 'https://images.unsplash.com/photo-1540959733332-eab4deabeeaf?q=80&w=1994&auto=format&fit=crop',
                tags: ['無購物', '保證出團', '桃園出發'],
                dates: ['2023/11/25 (五)', '2023/12/02 (五)', '2023/12/10 (六)'],
                days: [
                    {
                        day: 1,
                        title: '台北 → 東京成田空港 → 新宿飯店 Check-in',
                        desc: '集合於桃園國際機場，搭乘豪華客機飛往日本首都－東京。',
                        stay: 'Shinjuku Prince Hotel 或同級'
                    },
                    {
                        day: 2,
                        title: '原宿竹下通探險 → 庫洛米主題咖啡廳 → 澀谷十字路口',
                        desc: '今日前往年輕人的時尚聖地原宿，尋找最酷炫的龐克配件。',
                        images: [
                            'https://images.unsplash.com/photo-1536098561742-ca998e48cbcc?q=80&w=2036&auto=format&fit=crop',
                            'https://images.unsplash.com/photo-1503899036084-c55cdd92a805?q=80&w=2070&auto=format&fit=crop'
                        ]
                    }
                ]
            },
            'osaka': {
                title: '大阪黑門市場美食與環球影城｜庫洛米特別企劃・5日',
                price: '$32,800',
                originalPrice: '$35,000',
                image: 'https://images.unsplash.com/photo-1524024926029-b31379629e36?q=80&w=1932&auto=format&fit=crop',
                tags: ['USJ門票', '含快速通關', '關西進出'],
                dates: ['2023/12/05 (一)', '2023/12/12 (一)', '2023/12/20 (二)'],
                days: [
                    {
                        day: 1,
                        title: '台北 → 大阪關西空港 → 道頓堀',
                        desc: '抵達大阪，前往最熱鬧的道頓堀享受美食。',
                        stay: 'Osaka Excel Hotel Tokyu 或同級'
                    },
                    {
                        day: 2,
                        title: '環球影城全日遊 (含快速通關)',
                        desc: '全日暢遊環球影城，體驗哈利波特與瑪利歐世界。',
                        images: [
                            'https://images.unsplash.com/photo-1623941000838-d323579605e2?q=80&w=1974&auto=format&fit=crop'
                        ]
                    }
                ]
            },
            'seoul': {
                title: '首爾弘大暗黑時尚｜哥德式咖啡廳・地下樂團巡演・5日',
                price: '$18,900',
                originalPrice: '$22,000',
                image: 'https://images.unsplash.com/photo-1538485399081-7191377e8241?q=80&w=1974&auto=format&fit=crop',
                tags: ['仁川進出', '弘大住宿', '無購物'],
                dates: ['2024/01/10 (三)', '2024/01/17 (三)', '2024/01/24 (三)'],
                days: [
                    {
                        day: 1,
                        title: '台北 → 仁川空港 → 弘大商圈',
                        desc: '抵達首爾，入住充滿年輕活力的弘大區。',
                        stay: 'L7 Hongdae 或同級'
                    },
                    {
                        day: 2,
                        title: '弘大自由逛街 → 哥德式主題咖啡廳',
                        desc: '探索弘大巷弄內的特色小店與主題咖啡廳。',
                        images: [
                            'https://images.unsplash.com/photo-1517248135467-4c7edcad34c4?q=80&w=2070&auto=format&fit=crop'
                        ]
                    }
                ]
            },
            'bangkok': {
                title: '曼谷午夜市集狂歡｜高空酒吧・霓虹夜生活・6日',
                price: '$15,500',
                originalPrice: '$18,000',
                image: 'https://images.unsplash.com/photo-1508009603885-50cf7c579365?q=80&w=1950&auto=format&fit=crop',
                tags: ['BKK進出', '五星飯店', '泰式按摩'],
                dates: ['2024/02/05 (一)', '2024/02/12 (一)', '2024/02/19 (一)'],
                days: [
                    {
                        day: 1,
                        title: '台北 → 曼谷蘇凡納布機場 → 飯店 Check-in',
                        desc: '抵達曼谷，專車接送至五星級飯店休息。',
                        stay: 'Grande Centre Point Terminal 21 或同級'
                    },
                    {
                        day: 2,
                        title: '恰圖恰週末市集 → 喬德夜市',
                        desc: '體驗曼谷最大的週末市集與新興的網美夜市。',
                        images: [
                            'https://images.unsplash.com/photo-1559563362-c667ba5f5480?q=80&w=2001&auto=format&fit=crop'
                        ]
                    }
                ]
            },
            'berlin': {
                title: '柏林地下電音聖殿｜廢墟塗鴉藝術・Techno 派對・9日',
                price: '$55,000',
                originalPrice: '$60,000',
                image: 'https://images.unsplash.com/photo-1599946347371-68eb71b16afc?q=80&w=2070&auto=format&fit=crop',
                tags: ['柏林進出', '特色旅宿', '深度旅遊'],
                dates: ['2024/03/10 (日)', '2024/03/20 (三)', '2024/03/30 (六)'],
                days: [
                    {
                        day: 1,
                        title: '台北 → 法蘭克福 → 柏林',
                        desc: '搭乘長途班機前往德國首都柏林。',
                        stay: 'Michelberger Hotel 或同級'
                    },
                    {
                        day: 2,
                        title: '東邊畫廊 → 十字山區塗鴉導覽',
                        desc: '欣賞柏林圍牆遺跡上的塗鴉藝術，探索次文化重鎮。',
                        images: [
                            'https://images.unsplash.com/photo-1560969184-10fe8719e047?q=80&w=2070&auto=format&fit=crop'
                        ]
                    }
                ]
            },
            'london': {
                title: '倫敦地下音樂聖地朝聖｜Camden Town 市集挖寶・歌德建築・8日',
                price: '$62,000',
                originalPrice: '$68,900',
                image: 'https://images.unsplash.com/photo-1517935706615-2717063c2225?q=80&w=1965&auto=format&fit=crop',
                tags: ['倫敦進出', '市區住宿', '英式下午茶'],
                dates: ['2024/04/01 (一)', '2024/04/15 (一)'],
                days: [
                    {
                        day: 1,
                        title: '台北 → 倫敦希斯洛機場',
                        desc: '飛往霧都倫敦，展開英倫搖滾之旅。',
                        stay: 'Royal National Hotel 或同級'
                    },
                    {
                        day: 2,
                        title: 'Camden Town 市集 → Amy Winehouse 雕像',
                        desc: '倫敦最龐克的市集，尋找古著與黑膠唱片。',
                        images: [
                            'https://images.unsplash.com/photo-1529655683826-aba9b3e77383?q=80&w=1965&auto=format&fit=crop'
                        ]
                    }
                ]
            },
            'kyoto': {
                title: '京都夜行百鬼夜行特別企劃｜古寺探險・和服體驗・5日',
                price: '$29,999',
                originalPrice: '$32,000',
                image: 'https://images.unsplash.com/photo-1493976040374-85c8e12f0c0e?q=80&w=2070&auto=format&fit=crop',
                tags: ['京都進出', '古民家住宿', '特色體驗'],
                dates: ['2024/05/10 (五)', '2024/05/20 (一)'],
                days: [
                    {
                        day: 1,
                        title: '台北 → 關西空港 → 京都',
                        desc: '抵達千年古都京都，感受靜謐的夜晚。',
                        stay: 'Kyoto Machiya Stay 或同級'
                    },
                    {
                        day: 2,
                        title: '伏見稻荷大社 → 貴船神社',
                        desc: '探訪千本鳥居與神秘的水占卜。',
                        images: [
                            'https://images.unsplash.com/photo-1478436127897-769e1b3f0f36?q=80&w=2070&auto=format&fit=crop'
                        ]
                    }
                ]
            },
            'paris': {
                title: '巴黎地下墓穴探險｜歌德式教堂巡禮・蒙馬特藝術・7日',
                price: '$52,900',
                originalPrice: '$58,000',
                image: 'https://images.unsplash.com/photo-1502602898657-3e91760cbb34?q=80&w=2073&auto=format&fit=crop',
                tags: ['巴黎進出', '深度導覽', '藝術之旅'],
                dates: ['2024/06/15 (六)', '2024/06/25 (二)'],
                days: [
                    {
                        day: 1,
                        title: '台北 → 巴黎戴高樂機場',
                        desc: '飛往浪漫之都巴黎，入住蒙馬特區特色旅宿。',
                        stay: 'Hotel Montmartre Mon Amour 或同級'
                    },
                    {
                        day: 2,
                        title: '巴黎地下墓穴 → 聖母院',
                        desc: '深入巴黎地下世界，探索神秘的地下墓穴，下午參觀浴火重生的聖母院。',
                        images: [
                            'https://images.unsplash.com/photo-1549140600-78c9b8275e0d?q=80&w=2070&auto=format&fit=crop'
                        ]
                    }
                ]
            },
            'nyc': {
                title: '紐約東村龐克搖滾｜CBGB舊址朝聖・布魯克林地下藝術・8日',
                price: '$68,800',
                originalPrice: '$75,000',
                image: 'https://images.unsplash.com/photo-1496442226666-8d4a0e62e6e9?q=80&w=2070&auto=format&fit=crop',
                tags: ['紐約進出', '地鐵體驗', '美式漢堡'],
                dates: ['2024/07/10 (三)', '2024/07/20 (六)'],
                days: [
                    {
                        day: 1,
                        title: '台北 → 紐約甘迺迪機場',
                        desc: '抵達大蘋果紐約，感受不夜城的活力。',
                        stay: 'Ace Hotel New York 或同級'
                    },
                    {
                        day: 2,
                        title: '東村龐克歷史導覽 → CBGB 舊址',
                        desc: '走訪龐克搖滾的發源地，感受 70 年代的叛逆精神。',
                        images: [
                            'https://images.unsplash.com/photo-1534270804882-6b5048b1c1fc?q=80&w=2060&auto=format&fit=crop'
                        ]
                    }
                ]
            },
            'taipei': {
                title: '台北西門町次文化｜刺青街巡禮・Live House 體驗・3日',
                price: '$6,666',
                originalPrice: '$8,000',
                image: 'https://images.unsplash.com/photo-1552422554-0d5af0a7a968?q=80&w=2070&auto=format&fit=crop',
                tags: ['在地體驗', '夜市美食', '潮流文化'],
                dates: ['2024/08/05 (一)', '2024/08/12 (一)'],
                days: [
                    {
                        day: 1,
                        title: '集合 → 西門町飯店 Check-in',
                        desc: '入住西門町潮流飯店，晚上自由探索美國街與刺青街。',
                        stay: 'Papa Whale Hotel 或同級'
                    },
                    {
                        day: 2,
                        title: 'Live House 演出欣賞 → 寧夏夜市',
                        desc: '前往 The Wall 或 Legacy 欣賞獨立樂團演出，宵夜享用夜市美食。',
                        images: [
                            'https://images.unsplash.com/photo-1514525253440-b393452e3720?q=80&w=1974&auto=format&fit=crop'
                        ]
                    }
                ]
            }
        };


        // Helper: Generate inline SVG as data URL (no external dependencies)
        function generateColoredImage(color, text, width = 800, height = 600) {
            const svg = `
                <svg xmlns="http://www.w3.org/2000/svg" width="${width}" height="${height}">
                    <rect width="${width}" height="${height}" fill="${color}"/>
                    <text x="50%" y="50%" text-anchor="middle" font-family="Arial, sans-serif" 
                          font-size="32" font-weight="bold" fill="white">${text}</text>
                </svg>
            `;
            return 'data:image/svg+xml;base64,' + btoa(unescape(encodeURIComponent(svg)));
        }

        // Generate 50 Mock Itineraries
        function generateItineraries() {
            // Curated worldwide itineraries with unique themes
            const worldItineraries = [
                // Asia
                {
                    id: 'tokyo_neon',
                    title: '東京賽博龐克霓虹夜｜6日',
                    price: '$45,000',
                    originalPrice: '$52,000',
                    image: 'https://via.placeholder.com/800x600/9B72AA/FFFFFF?text=Tokyo+Neon',
                    tags: ['東京進出', '賽博龐克', '夜生活'],
                    dates: ['2024/06/15', '2024/07/20', '2024/08/25'],
                    description: '探索東京未來科技與傳統文化的衝突美學',
                    days: [
                        { day: 1, title: '抵達成田機場', desc: '專車接送至澀谷設計旅店，夜遊新宿歌舞伎町霓虹街。', stay: 'Shibuya Design Hotel' },
                        { day: 2, title: '秋葉原電子聖地', desc: '深入秋葉原電子街區，探訪Maid咖啡廳與地下街。', images: ['https://via.placeholder.com/400x300/E94560/FFFFFF?text=Akihabara', 'https://via.placeholder.com/400x300/0F3460/FFFFFF?text=Maid+Cafe'] },
                        { day: 3, title: '哈拉原龐克時尚', desc: '原宿竹下通與表參道，體驗日本青年叛逆文化。', images: ['https://via.placeholder.com/400x300/9B72AA/FFFFFF?text=Harajuku', 'https://via.placeholder.com/400x300/16213E/FFFFFF?text=Street+Fashion'] },
                        { day: 4, title: '銀座地下酒吧巡禮', desc: '探訪隱密的銀座地下威士忌酒吧與爵士樂俱樂部。', stay: 'Ginza Boutique Hotel' },
                        { day: 5, title: '六本木藝術三角', desc: '森美術館、國立新美術館，感受當代藝術脈動。', images: ['https://via.placeholder.com/400x300/533483/FFFFFF?text=Mori+Museum'] },
                        { day: 6, title: '離境', desc: '自由活動後送機', stay: null }
                    ]
                },
                {
                    id: 'seoul_underground',
                    title: '首爾弘大暗黑時尚｜5日',
                    price: '$32,000',
                    originalPrice: '$38,000',
                    image: 'https://via.placeholder.com/800x600/1A1A2E/FFFFFF?text=Seoul+Underground',
                    tags: ['首爾進出', '暗黑哥德', 'K-Fashion'],
                    dates: ['2024/06/10', '2024/07/15', '2024/09/05'],
                    description: '首爾地下文化與新世代時尚的完美結合',
                    days: [
                        { day: 1, title: '抵達仁川', desc: '入住弘大創意旅店，夜探望遠市場小吃。', stay: 'Hongdae Creative Hostel' },
                        { day: 2, title: '弘大街頭藝術', desc: '探訪弘大塗鴉牆與獨立設計師小店，哥德風咖啡廳下午茶。', images: ['https://via.placeholder.com/400x300/E94560/FFFFFF?text=Street+Art', 'https://via.placeholder.com/400x300/0F3460/FFFFFF?text=Gothic+Cafe'] },
                        { day: 3, title: '梨泰院多元文化', desc: '梨泰院異國料理與Vintage古著店巡禮。', images: ['https://via.placeholder.com/400x300/9B72AA/FFFFFF?text=Itaewon'] },
                        { day: 4, title: '江南地下樂團', desc: '參觀獨立音樂Live House，感受韓國搖滾魂。', stay: 'Gangnam Music Hotel' },
                        { day: 5, title: '返程', desc: '明洞最後採購後送機', stay: null }
                    ]
                },
                {
                    id: 'bangkok_midnight',
                    title: '曼谷午夜市集狂歡｜5日',
                    price: '$28,000',
                    originalPrice: '$33,000',
                    image: 'https://via.placeholder.com/800x600/16213E/FFFFFF?text=Bangkok+Night',
                    tags: ['曼谷進出', '夜市文化', '泰式搖滾'],
                    dates: ['2024/06/20', '2024/07/25', '2024/08/30'],
                    description: '曼谷不夜城的瘋狂能量與街頭美食',
                    days: [
                        { day: 1, title: '抵達素萬那普', desc: '考山路背包客天堂，夜訪Ratchada火車夜市。', stay: 'Khao San Hostel' },
                        { day: 2, title: 'Chatuchak週末市集', desc: '全亞洲最大週末市集血拼，復古服飾與手工藝品。', images: ['https://via.placeholder.com/400x300/E94560/FFFFFF?text=Chatuchak', 'https://via.placeholder.com/400x300/533483/FFFFFF?text=Vintage+Shop'] },
                        { day: 3, title: '暹羅廣場文青區', desc: '探訪MBK、Siam Square獨立書店與藝廊。', images: ['https://via.placeholder.com/400x300/0F3460/FFFFFF?text=Siam'] },
                        { day: 4, title: 'RCA夜店一條街', desc: '體驗曼谷最瘋狂的夜生活與電音派對。', stay: 'RCA Party Hotel' },
                        { day: 5, title: '返程', desc: '水上市場早餐後送機', stay: null }
                    ]
                },
                {
                    id: 'singapore_future',
                    title: '新加坡未來城市實驗｜5日',
                    price: '$38,000',
                    originalPrice: '$44,000',
                    image: 'https://via.placeholder.com/800x600/533483/FFFFFF?text=Singapore+Future',
                    tags: ['新加坡進出', '科技城市', '多元文化'],
                    dates: ['2024/06/12', '2024/07/18', '2024/08/22'],
                    description: '花園城市的科技奇蹟與多元文化碰撞',
                    days: [
                        { day: 1, title: '抵達樟宜機場', desc: '濱海灣花園Super Tree夜景，入住Marina Bay設計酒店。', stay: 'Marina Bay Design Hotel' },
                        { day: 2, title: '牛車水與小印度', desc: '探訪唐人街與印度區的文化衝突美學。', images: ['https://via.placeholder.com/400x300/9B72AA/FFFFFF?text=Chinatown', 'https://via.placeholder.com/400x300/E94560/FFFFFF?text=Little+India'] },
                        { day: 3, title: '烏節路時尚購物', desc: 'ION Orchard與設計師品牌朝聖。', images: ['https://via.placeholder.com/400x300/0F3460/FFFFFF?text=Orchard'] },
                        { day: 4, title: '聖淘沙未來樂園', desc: '環球影城與S.E.A海洋館科技體驗。', stay: 'Sentosa Resort' },
                        { day: 5, title: '返程', desc: '克拉碼頭早午餐後送機', stay: null }
                    ]
                },

                // Europe
                {
                    id: 'berlin_techno',
                    title: '柏林地下電音聖殿｜7日',
                    price: '$55,000',
                    originalPrice: '$62,000',
                    image: 'https://via.placeholder.com/800x600/1A1A2E/FFFFFF?text=Berlin+Techno',
                    tags: ['柏林進出', '電音文化', '工業廢墟'],
                    dates: ['2024/06/18', '2024/07/22', '2024/08/28'],
                    description: '柏林地下電音與工業廢墟美學的極致體驗',
                    days: [
                        { day: 1, title: '抵達柏林', desc: '入住Kreuzberg藝術區旅店，夜訪Berghain前哨站。', stay: 'Kreuzberg Art Hostel' },
                        { day: 2, title: '東邊畫廊與廢墟', desc: '柏林圍牆東邊畫廊，探訪廢棄工業區。', images: ['https://via.placeholder.com/400x300/E94560/FFFFFF?text=East+Gallery', 'https://via.placeholder.com/400x300/16213E/FFFFFF?text=Ruins'] },
                        { day: 3, title: 'Berghain週末馬拉松', desc: '全球最強Techno俱樂部48小時狂歡。', stay: 'Party Hotel' },
                        { day: 4, title: '包浩斯建築巡禮', desc: '探訪包浩斯博物館與現代主義建築。', images: ['https://via.placeholder.com/400x300/533483/FFFFFF?text=Bauhaus'] },
                        { day: 5, title: 'Teufelsberg廢棄監聽站', desc: '冷戰時期NSA監聽站廢墟探險。', images: ['https://via.placeholder.com/400x300/0F3460/FFFFFF?text=Teufelsberg'] },
                        { day: 6, title: 'Tresor與工業電音', desc: '參觀傳奇俱樂部Tresor，感受柏林電音魂。', stay: 'Industrial Loft' },
                        { day: 7, title: '返程', desc: '亞歷山大廣場最後巡禮', stay: null }
                    ]
                },
                {
                    id: 'paris_gothic',
                    title: '巴黎哥德式浪漫｜6日',
                    price: '$62,000',
                    originalPrice: '$70,000',
                    image: 'https://via.placeholder.com/800x600/9B72AA/FFFFFF?text=Paris+Gothic',
                    tags: ['巴黎進出', '哥德建築', '暗黑美學'],
                    dates: ['2024/06/22', '2024/07/28', '2024/09/15'],
                    description: '巴黎聖母院的哥德魅影與暗黑浪漫',
                    days: [
                        { day: 1, title: '抵達戴高樂機場', desc: '入住瑪黑區精品旅店，夜訪塞納河畔。', stay: 'Le Marais Boutique' },
                        { day: 2, title: '聖母院哥德建築', desc: '巴黎聖母院、聖禮拜堂彩繪玻璃巡禮。', images: ['https://via.placeholder.com/400x300/1A1A2E/FFFFFF?text=Notre+Dame', 'https://via.placeholder.com/400x300/533483/FFFFFF?text=Sainte+Chapelle'] },
                        { day: 3, title: '拉榭茲神父公墓', desc: '探訪王爾德、蕭邦、Jim Morrison之墓。', images: ['https://via.placeholder.com/400x300/16213E/FFFFFF?text=Pere+Lachaise'] },
                        { day: 4, title: '龐畢度中心當代藝術', desc: '龐畢度中心與周圍地下藝廊。', stay: 'Pompidou Loft' },
                        { day: 5, title: '凡爾賽宮巴洛克奢華', desc: '凡爾賽宮一日遊，感受法式宮廷美學。', images: ['https://via.placeholder.com/400x300/9B72AA/FFFFFF?text=Versailles'] },
                        { day: 6, title: '返程', desc: '蒙馬特藝術區最後漫步', stay: null }
                    ]
                },
                {
                    id: 'prague_vampire',
                    title: '布拉格吸血鬼傳說｜6日',
                    price: '$48,000',
                    originalPrice: '$55,000',
                    image: 'https://via.placeholder.com/800x600/16213E/FFFFFF?text=Prague+Vampire',
                    tags: ['布拉格進出', '吸血鬼', '中世紀'],
                    dates: ['2024/06/25', '2024/07/30', '2024/09/10'],
                    description: '布拉格中世紀古城的吸血鬼與鍊金術傳說',
                    days: [
                        { day: 1, title: '抵達布拉格', desc: '入住舊城區哥德旅店，查理大橋夜遊。', stay: 'Old Town Gothic Hotel' },
                        { day: 2, title: '布拉格城堡探秘', desc: '探訪城堡區與黃金巷鍊金術士遺跡。', images: ['https://via.placeholder.com/400x300/1A1A2E/FFFFFF?text=Prague+Castle', 'https://via.placeholder.com/400x300/533483/FFFFFF?text=Golden+Lane'] },
                        { day: 3, title: '地下墓穴與骨教堂', desc: '參觀Sedlec人骨教堂，感受死亡美學。', images: ['https://via.placeholder.com/400x300/E94560/FFFFFF?text=Bone+Church'] },
                        { day: 4, title: '吸血鬼夜遊', desc: '專業導遊帶領，探訪布拉格吸血鬼傳說景點。', stay: 'Vampire Theme Hotel' },
                        { day: 5, title: '卡夫卡與布拉格文學', desc: '參觀卡夫卡博物館，漫步文學咖啡廳。', images: ['https://via.placeholder.com/400x300/9B72AA/FFFFFF?text=Kafka+Museum'] },
                        { day: 6, title: '返程', desc: '舊城廣場天文鐘最後巡禮', stay: null }
                    ]
                },
                {
                    id: 'amsterdam_freedom',
                    title: '阿姆斯特丹自由之城｜5日',
                    price: '$52,000',
                    originalPrice: '$59,000',
                    image: 'https://via.placeholder.com/800x600/0F3460/FFFFFF?text=Amsterdam+Freedom',
                    tags: ['阿姆斯特丹進出', '自由文化', '運河藝術'],
                    dates: ['2024/06/28', '2024/08/05', '2024/09/18'],
                    description: '阿姆斯特丹運河與自由文化的獨特魅力',
                    days: [
                        { day: 1, title: '抵達史基浦機場', desc: '入住運河區精品旅店，自行車遊城。', stay: 'Canal Belt Hotel' },
                        { day: 2, title: '梵谷博物館與紅燈區', desc: '白天藝術，夜晚探訪紅燈區文化。', images: ['https://via.placeholder.com/400x300/E94560/FFFFFF?text=Van+Gogh', 'https://via.placeholder.com/400x300/533483/FFFFFF?text=Red+Light'] },
                        { day: 3, title: '安妮之家與二戰歷史', desc: '參觀安妮法蘭克之家，了解二戰歷史。', images: ['https://via.placeholder.com/400x300/16213E/FFFFFF?text=Anne+Frank'] },
                        { day: 4, title: 'Coffee Shop文化體驗', desc: '探訪阿姆斯特丹獨特的Coffee Shop文化。', stay: 'Jordaan District Hotel' },
                        { day: 5, title: '返程', desc: '水壩廣場最後採購', stay: null }
                    ]
                },
                {
                    id: 'reykjavik_aurora',
                    title: '雷克雅維克極光追獵｜7日',
                    price: '$78,000',
                    originalPrice: '$88,000',
                    image: 'https://via.placeholder.com/800x600/533483/FFFFFF?text=Iceland+Aurora',
                    tags: ['冰島環島', '極光', '冰火世界'],
                    dates: ['2024/11/15', '2024/12/20', '2025/01/25'],
                    description: '冰島極光與冰火世界的終極探險',
                    days: [
                        { day: 1, title: '抵達雷克雅維克', desc: '入住首都設計旅店，藍湖溫泉放鬆。', stay: 'Reykjavik Design Hotel' },
                        { day: 2, title: '金圈經典路線', desc: '黃金瀑布、間歇泉、國會斷層一日遊。', images: ['https://via.placeholder.com/400x300/9B72AA/FFFFFF?text=Golden+Circle', 'https://via.placeholder.com/400x300/0F3460/FFFFFF?text=Geyser'] },
                        { day: 3, title: '黑沙灘與冰川', desc: '維克黑沙灘、Skaftafell冰川健行。', images: ['https://via.placeholder.com/400x300/1A1A2E/FFFFFF?text=Black+Beach', 'https://via.placeholder.com/400x300/16213E/FFFFFF?text=Glacier'] },
                        { day: 4, title: '冰河湖與鑽石沙灘', desc: '傑古沙龍冰河湖遊船，鑽石沙灘攝影。', stay: 'Jokulsarlon Lodge' },
                        { day: 5, title: '極光追獵夜', desc: '專業導遊帶領，追尋北極光奇景。', images: ['https://via.placeholder.com/400x300/533483/FFFFFF?text=Aurora'] },
                        { day: 6, title: '斯奈山半島', desc: '教會山、黑教堂，感受冰島孤獨美學。', images: ['https://via.placeholder.com/400x300/E94560/FFFFFF?text=Kirkjufell'] },
                        { day: 7, title: '返程', desc: '雷克雅維克市區最後巡禮', stay: null }
                    ]
                },

                // Americas
                {
                    id: 'nyc_underground',
                    title: '紐約地下文化聖地｜7日',
                    price: '$68,000',
                    originalPrice: '$76,000',
                    image: 'https://via.placeholder.com/800x600/E94560/FFFFFF?text=NYC+Underground',
                    tags: ['紐約進出', '地下文化', '嘻哈搖滾'],
                    dates: ['2024/06/15', '2024/07/20', '2024/08/25'],
                    description: '紐約地下音樂與街頭文化的起源地',
                    days: [
                        { day: 1, title: '抵達JFK機場', desc: '入住布魯克林Williamsburg藝術區。', stay: 'Brooklyn Loft Hotel' },
                        { day: 2, title: '布魯克林塗鴉藝術', desc: 'Bushwick塗鴉區與獨立藝廊巡禮。', images: ['https://via.placeholder.com/400x300/9B72AA/FFFFFF?text=Bushwick+Graffiti', 'https://via.placeholder.com/400x300/1A1A2E/FFFFFF?text=Street+Art'] },
                        { day: 3, title: 'CBGB龐克聖地', desc: '探訪CBGB遺址，East Village龐克文化。', images: ['https://via.placeholder.com/400x300/E94560/FFFFFF?text=CBGB'] },
                        { day: 4, title: '哈林區爵士與嘻哈', desc: 'Apollo劇院，探索爵士與嘻哈起源。', stay: 'Harlem Jazz Hotel' },
                        { day: 5, title: 'MoMA與當代藝術', desc: '現代藝術博物館，感受前衛藝術。', images: ['https://via.placeholder.com/400x300/533483/FFFFFF?text=MoMA'] },
                        { day: 6, title: '布魯克林音樂廳', desc: '參加Brooklyn Steel或Music Hall演唱會。', stay: 'Brooklyn Music Hotel' },
                        { day: 7, title: '返程', desc: 'Times Square最後巡禮', stay: null }
                    ]
                },
                {
                    id: 'la_hollywood',
                    title: '洛杉磯好萊塢夢工廠｜6日',
                    price: '$58,000',
                    originalPrice: '$66,000',
                    image: 'https://via.placeholder.com/800x600/16213E/FFFFFF?text=LA+Hollywood',
                    tags: ['洛杉磯進出', '好萊塢', '海灘文化'],
                    dates: ['2024/06/18', '2024/07/22', '2024/08/28'],
                    description: '洛杉磯電影夢與加州陽光海灘',
                    days: [
                        { day: 1, title: '抵達LAX', desc: '入住Santa Monica海灘旅店，66號公路終點朝聖。', stay: 'Santa Monica Beach Hotel' },
                        { day: 2, title: '好萊塢星光大道', desc: 'Walk of Fame、TCL中國戲院，環球影城。', images: ['https://via.placeholder.com/400x300/E94560/FFFFFF?text=Hollywood+Sign', 'https://via.placeholder.com/400x300/9B72AA/FFFFFF?text=Walk+of+Fame'] },
                        { day: 3, title: 'Venice Beach嬉皮文化', desc: 'Venice運河、Muscle Beach，街頭藝人表演。', images: ['https://via.placeholder.com/400x300/0F3460/FFFFFF?text=Venice+Beach'] },
                        { day: 4, title: '比佛利山莊奢華', desc: 'Rodeo Drive精品街，Getty Center藝術館。', stay: 'Beverly Hills Hotel' },
                        { day: 5, title: '格里斐斯天文台', desc: '白天天文台，夜晚俯瞰洛杉磯夜景。', images: ['https://via.placeholder.com/400x300/533483/FFFFFF?text=Griffith+Observatory'] },
                        { day: 6, title: '返程', desc: 'The Grove最後採購', stay: null }
                    ]
                },
                {
                    id: 'mexico_dead',
                    title: '墨西哥亡靈節狂歡｜7日',
                    price: '$52,000',
                    originalPrice: '$60,000',
                    image: 'https://via.placeholder.com/800x600/E94560/FFFFFF?text=Mexico+Dead',
                    tags: ['墨西哥城進出', '亡靈節', '瑪雅文化'],
                    dates: ['2024/10/28', '2024/11/01', '2024/11/02'],
                    description: '墨西哥亡靈節的生死美學與瑪雅古文明',
                    days: [
                        { day: 1, title: '抵達墨西哥城', desc: '入住歷史中心旅店，憲法廣場夜遊。', stay: 'Centro Historico Hotel' },
                        { day: 2, title: '特奧蒂瓦坎金字塔', desc: '日月金字塔朝聖，感受古文明力量。', images: ['https://via.placeholder.com/400x300/533483/FFFFFF?text=Teotihuacan', 'https://via.placeholder.com/400x300/16213E/FFFFFF?text=Pyramid'] },
                        { day: 3, title: '芙烈達博物館', desc: '探訪Frida Kahlo藍屋，了解墨西哥藝術。', images: ['https://via.placeholder.com/400x300/9B72AA/FFFFFF?text=Frida+Museum'] },
                        { day: 4, title: '亡靈節慶典準備', desc: '製作骷髏面具，學習傳統祭壇布置。', stay: 'Day of the Dead Hotel' },
                        { day: 5, title: '亡靈節大遊行', desc: '參加墨西哥城亡靈節大遊行，夜訪墓園。', images: ['https://via.placeholder.com/400x300/E94560/FFFFFF?text=Parade', 'https://via.placeholder.com/400x300/1A1A2E/FFFFFF?text=Cemetery'] },
                        { day: 6, title: '瓜納華托彩色小鎮', desc: '探訪彩色山城與地下墓穴。', images: ['https://via.placeholder.com/400x300/0F3460/FFFFFF?text=Guanajuato'] },
                        { day: 7, title: '返程', desc: '索卡洛廣場最後巡禮', stay: null }
                    ]
                },
                {
                    id: 'rio_carnival',
                    title: '里約熱內盧嘉年華｜7日',
                    price: '$72,000',
                    originalPrice: '$82,000',
                    image: 'https://via.placeholder.com/800x600/E94560/FFFFFF?text=Rio+Carnival',
                    tags: ['里約進出', '嘉年華', '森巴文化'],
                    dates: ['2025/02/22', '2025/02/24', '2025/02/26'],
                    description: '里約嘉年華森巴狂歡與海灘文化',
                    days: [
                        { day: 1, title: '抵達里約', desc: '入住Copacabana海灘旅店，感受熱情氛圍。', stay: 'Copacabana Beach Hotel' },
                        { day: 2, title: '基督像與麵包山', desc: '登山朝聖基督像，纜車上麵包山看夜景。', images: ['https://via.placeholder.com/400x300/9B72AA/FFFFFF?text=Christ+Redeemer', 'https://via.placeholder.com/400x300/533483/FFFFFF?text=Sugarloaf'] },
                        { day: 3, title: '森巴舞學校參訪', desc: '參觀森巴學校排練，學習森巴舞步。', images: ['https://via.placeholder.com/400x300/E94560/FFFFFF?text=Samba+School'] },
                        { day: 4, title: '嘉年華大遊行', desc: '森巴大道觀賞世界級遊行表演。', stay: 'Sambadrome VIP Hotel' },
                        { day: 5, title: '街頭嘉年華派對', desc: '加入街頭Blocos派對，徹夜狂歡。', images: ['https://via.placeholder.com/400x300/16213E/FFFFFF?text=Street+Party'] },
                        { day: 6, title: 'Ipanema海灘放鬆', desc: '海灘放鬆，享受Caipirinha雞尾酒。', images: ['https://via.placeholder.com/400x300/0F3460/FFFFFF?text=Ipanema+Beach'] },
                        { day: 7, title: '返程', desc: 'Lapa階梯最後巡禮', stay: null }
                    ]
                },

                // Oceania
                {
                    id: 'sydney_opera',
                    title: '雪梨歌劇院藝術之旅｜6日',
                    price: '$58,000',
                    originalPrice: '$66,000',
                    image: 'https://via.placeholder.com/800x600/0F3460/FFFFFF?text=Sydney+Opera',
                    tags: ['雪梨進出', '藝術文化', '海港城市'],
                    dates: ['2024/06/20', '2024/07/25', '2024/08/30'],
                    description: '雪梨歌劇院與海港大橋的經典魅力',
                    days: [
                        { day: 1, title: '抵達雪梨', desc: '入住環形碼頭旅店，夜遊Harbour Bridge。', stay: 'Circular Quay Hotel' },
                        { day: 2, title: '歌劇院與皇家植物園', desc: '歌劇院導覽，漫步皇家植物園。', images: ['https://via.placeholder.com/400x300/9B72AA/FFFFFF?text=Opera+House', 'https://via.placeholder.com/400x300/533483/FFFFFF?text=Botanic+Garden'] },
                        { day: 3, title: 'Bondi Beach衝浪', desc: 'Bondi to Coogee海岸步道，衝浪體驗。', images: ['https://via.placeholder.com/400x300/0F3460/FFFFFF?text=Bondi+Beach'] },
                        { day: 4, title: 'The Rocks歷史區', desc: '探訪雪梨最古老街區與週末市集。', stay: 'The Rocks Heritage Hotel' },
                        { day: 5, title: 'Blue Mountains藍山', desc: '三姐妹岩、Scenic World纜車一日遊。', images: ['https://via.placeholder.com/400x300/16213E/FFFFFF?text=Three+Sisters'] },
                        { day: 6, title: '返程', desc: 'Darling Harbour最後採購', stay: null }
                    ]
                },
                {
                    id: 'auckland_maori',
                    title: '奧克蘭毛利文化探索｜6日',
                    price: '$52,000',
                    original價: '$60,000',
                    image: 'https://via.placeholder.com/800x600/533483/FFFFFF?text=Auckland+Maori',
                    tags: ['奧克蘭進出', '毛利文化', '魔戒場景'],
                    dates: ['2024/06/22', '2024/07/28', '2024/09/05'],
                    description: '紐西蘭毛利文化與中土世界的奇幻之旅',
                    days: [
                        { day: 1, title: '抵達奧克蘭', desc: '入住市中心旅店，天空塔夜景。', stay: 'Auckland Central Hotel' },
                        { day: 2, title: '懷托摩螢火蟲洞', desc: '地下螢火蟲洞奇景，哈比村一日遊。', images: ['https://via.placeholder.com/400x300/9B72AA/FFFFFF?text=Waitomo+Caves', 'https://via.placeholder.com/400x300/16213E/FFFFFF?text=Hobbiton'] },
                        { day: 3, title: '羅托魯瓦地熱奇觀', desc: '間歇泉、泥漿池，毛利文化村體驗。', images: ['https://via.placeholder.com/400x300/E94560/FFFFFF?text=Rotorua+Geothermal', 'https://via.placeholder.com/400x300/0F3460/FFFFFF?text=Maori+Village'] },
                        { day: 4, title: '毛利Hangi大餐', desc: '觀賞Haka戰舞，享用傳統Hangi地爐大餐。', stay: 'Rotorua Maori Hotel' },
                        { day: 5, title: 'Waiheke Island酒莊', desc: '搭渡輪至Waiheke島，品酒賞景。', images: ['https://via.placeholder.com/400x300/533483/FFFFFF?text=Waiheke'] },
                        { day: 6, title: '返程', desc: 'Queen Street最後採購', stay: null }
                    ]
                },

                // Africa & Middle East
                {
                    id: 'cairo_pyramid',
                    title: '開羅金字塔神秘之旅｜7日',
                    price: '$48,000',
                    originalPrice: '$56,000',
                    image: 'https://via.placeholder.com/800x600/E94560/FFFFFF?text=Cairo+Pyramid',
                    tags: ['開羅進出', '古埃及', '金字塔'],
                    dates: ['2024/10/15', '2024/11/20', '2024/12/18'],
                    description: '古埃及法老的神秘詛咒與金字塔之謎',
                    days: [
                        { day: 1, title: '抵達開羅', desc: '入住尼羅河畔旅店，Khan el-Khalili市集。', stay: 'Nile View Hotel' },
                        { day: 2, title: '吉薩金字塔群', desc: '大金字塔、人面獅身像，進入金字塔內部。', images: ['https://via.placeholder.com/400x300/E94560/FFFFFF?text=Great+Pyramid', 'https://via.placeholder.com/400x300/1A1A2E/FFFFFF?text=Sphinx'] },
                        { day: 3, title: '埃及博物館', desc: '圖坦卡門黃金面具，木乃伊室參觀。', images: ['https://via.placeholder.com/400x300/9B72AA/FFFFFF?text=Egyptian+Museum', 'https://via.placeholder.com/400x300/533483/FFFFFF?text=Tutankhamun'] },
                        { day: 4, title: '薩卡拉階梯金字塔', desc: '最古老的階梯金字塔，Memphis古城遺址。', images: ['https://via.placeholder.com/400x300/16213E/FFFFFF?text=Saqqara'] },
                        { day: 5, title: '亞歷山大港', desc: '地中海明珠，Bibliotheca Alexandrina新圖書館。', stay: 'Alexandria Sea Hotel' },
                        { day: 6, title: '尼羅河遊船晚宴', desc: '搭乘尼羅河遊船，觀賞肚皮舞表演。', images: ['https://via.placeholder.com/400x300/0F3460/FFFFFF?text=Nile+Cruise'] },
                        { day: 7, title: '返程', desc: 'Coptic Cairo基督教區巡禮', stay: null }
                    ]
                },
                {
                    id: 'dubai_luxury',
                    title: '杜拜奢華沙漠綠洲｜6日',
                    price: '$88,000',
                    originalPrice: '$98,000',
                    image: 'https://via.placeholder.com/800x600/9B72AA/FFFFFF?text=Dubai+Luxury',
                    tags: ['杜拜進出', '奢華體驗', '沙漠冒險'],
                    dates: ['2024/11/10', '2024/12/15', '2025/01/20'],
                    description: '杜拜極致奢華與沙漠冒險的完美結合',
                    days: [
                        { day: 1, title: '抵達杜拜', desc: '入住Burj Al Arab帆船酒店，體驗極致奢華。', stay: 'Burj Al Arab' },
                        { day: 2, title: '哈里發塔與Dubai Mall', desc: '登上世界最高樓，Dubai Mall血拼。', images: ['https://via.placeholder.com/400x300/E94560/FFFFFF?text=Burj+Khalifa', 'https://via.placeholder.com/400x300/533483/FFFFFF?text=Dubai+Mall'] },
                        { day: 3, title: '棕櫚島與亞特蘭提斯', desc: '棕櫚島單軌電車，Atlantis水族館。', images: ['https://via.placeholder.com/400x300/0F3460/FFFFFF?text=Palm+Jumeirah'] },
                        { day: 4, title: '沙漠Safari冒險', desc: '4x4衝沙、騎駱駝、貝都因營地BBQ晚餐。', stay: 'Desert Camp' },
                        { day: 5, title: '杜拜黃金市集', desc: '黃金市集、香料市集，傳統Abra渡船。', images: ['https://via.placeholder.com/400x300/9B72AA/FFFFFF?text=Gold+Souk'] },
                        { day: 6, title: '返程', desc: 'Dubai Marina最後巡禮', stay: null }
                    ]
                },
                {
                    id: 'marrakech_medina',
                    title: '馬拉喀什千夜迷宮｜7日',
                    price: '$42,000',
                    originalPrice: '$50,000',
                    image: 'https://via.placeholder.com/800x600/E94560/FFFFFF?text=Marrakech+Medina',
                    tags: ['馬拉喀什進出', '摩洛哥', '沙漠古城'],
                    dates: ['2024/09/15', '2024/10/20', '2024/11/25'],
                    description: '摩洛哥馬拉喀什古城迷宮與撒哈拉沙漠',
                    days: [
                        { day: 1, title: '抵達馬拉喀什', desc: '入住Riad傳統庭院旅店，Jemaa el-Fnaa廣場。', stay: 'Traditional Riad' },
                        { day: 2, title: 'Medina老城迷宮', desc: '探索錯綜複雜的Souk市集與工匠街區。', images: ['https://via.placeholder.com/400x300/9B72AA/FFFFFF?text=Medina+Souk', 'https://via.placeholder.com/400x300/533483/FFFFFF?text=Artisan+Quarter'] },
                        { day: 3, title: '巴伊亞宮與花園', desc: '參觀巴伊亞宮、Majorelle花園。', images: ['https://via.placeholder.com/400x300/0F3460/FFFFFF?text=Bahia+Palace', 'https://via.placeholder.com/400x300/16213E/FFFFFF?text=Majorelle+Garden'] },
                        { day: 4, title: '撒哈拉沙漠三日遊Day1', desc: '翻越阿特拉斯山脈，抵達沙漠邊緣。', stay: 'Desert Lodge' },
                        { day: 5, title: '撒哈拉沙漠Day2', desc: '騎駱駝進入沙漠，帳篷露營看星空。', images: ['https://via.placeholder.com/400x300/E94560/FFFFFF?text=Sahara+Desert', 'https://via.placeholder.com/400x300/1A1A2E/FFFFFF?text=Camel+Trek'] },
                        { day: 6, title: '撒哈拉沙漠Day3返回', desc: '日出沙丘，返回馬拉喀什。', stay: 'Marrakech Riad' },
                        { day: 7, title: '返程', desc: 'Bahia宮最後巡禮', stay: null }
                    ]
                },
                {
                    id: 'capetown_safari',
                    title: '開普敦野生動物狩獵｜8日',
                    price: '$72,000',
                    originalPrice: '$82,000',
                    image: 'https://via.placeholder.com/800x600/533483/FFFFFF?text=Cape+Town+Safari',
                    tags: ['開普敦進出', 'Safari', '非洲五霸'],
                    dates: ['2024/07/10', '2024/08/15', '2024/09/20'],
                    description: '南非開普敦與Kruger國家公園Safari冒險',
                    days: [
                        { day: 1, title: '抵達開普敦', desc: '入住V&A Waterfront旅店，桌山纜車夜景。', stay: 'V&A Waterfront Hotel' },
                        { day: 2, title: '好望角與企鵝灘', desc: '非洲最西南端好望角，Boulders Beach企鵝。', images: ['https://via.placeholder.com/400x300/0F3460/FFFFFF?text=Cape+of+Good+Hope', 'https://via.placeholder.com/400x300/9B72AA/FFFFFF?text=Penguin+Beach'] },
                        { day: 3, title: 'Stellenbosch酒莊', desc: '開普敦酒鄉品酒，荷蘭風格小鎮漫步。', images: ['https://via.placeholder.com/400x300/16213E/FFFFFF?text=Wine+Farm'] },
                        { day: 4, title: '飛往Kruger國家公園', desc: '抵達野生動物保護區，傍晚Safari。', stay: 'Safari Lodge' },
                        { day: 5, title: 'Safari Day 1 - 非洲五霸', desc: '清晨與傍晚兩次Safari，尋找獅子、大象、犀牛、水牛、花豹。', images: ['https://via.placeholder.com/400x300/E94560/FFFFFF?text=Big+Five+Safari', 'https://via.placeholder.com/400x300/1A1A2E/FFFFFF?text=Lion'] },
                        { day: 6, title: 'Safari Day 2 - 深入叢林', desc: '全日Safari，Bush Walk叢林徒步體驗。', images: ['https://via.placeholder.com/400x300/533483/FFFFFF?text=Elephant+Herd'] },
                        { day: 7, title: '返回開普敦', desc: 'Bo-Kaap彩色房子區，Long Street酒吧。', stay: 'Cape Town City Hotel' },
                        { day: 8, title: '返程', desc: '最後採購紀念品', stay: null }
                    ]
                }
            ];

            // Add all itineraries to the global object and convert placeholder images to Data URLs
            worldItineraries.forEach(item => {
                // Convert main image from placeholder.com to SVG Data URL
                if (item.image && item.image.includes('via.placeholder.com')) {
                    const match = item.image.match(/\/(\w+)\/(\w+)\/(\w+)\?text=([^&]+)/);
                    if (match) {
                        const [_, size, bgColor, textColor, text] = match;
                        const [width, height] = size.split('x').map(Number);
                        item.image = generateColoredImage('#' + bgColor, decodeURIComponent(text.replace(/\+/g, ' ')), width || 800, height || 600);
                    }
                }

                // Convert day images from placeholder.com to SVG Data URLs
                if (item.days) {
                    item.days.forEach(day => {
                        if (day.images) {
                            day.images = day.images.map(img => {
                                if (img.includes('via.placeholder.com')) {
                                    const match = img.match(/\/(\w+)\/(\w+)\/(\w+)\?text=([^&]+)/);
                                    if (match) {
                                        const [_, size, bgColor, textColor, text] = match;
                                        const [width, height] = size.split('x').map(Number);
                                        return generateColoredImage('#' + bgColor, decodeURIComponent(text.replace(/\+/g, ' ')), width || 400, height || 300);
                                    }
                                }
                                return img;
                            });
                        }
                    });
                }

                itineraries[item.id] = item;
            });
        }

        // Render Itinerary List
        function renderItineraries(data = null) {
            const container = document.getElementById('search-results-container');
            const title = document.getElementById('search-results-title');

            // Use provided data or all itineraries
            const items = data ? Object.entries(data) : Object.entries(itineraries);

            title.innerText = `搜尋結果：共 ${items.length} 筆行程`;
            container.innerHTML = ''; // Clear static content

            items.forEach(([id, data]) => {
                const html = `
                    <div class="bg-[#222] rounded-lg overflow-hidden flex flex-col md:flex-row border border-transparent hover:border-[#9B72AA] transition group cursor-pointer mb-4"
                        onclick="showDetail('${id}')">
                        <div class="w-full md:w-1/3 h-48 md:h-auto relative">
                            <img src="${data.image}" class="w-full h-full object-cover">
                            <div class="wishlist-heart" onclick="event.stopPropagation(); toggleFavorite('${id}')" data-id="${id}">
                                <i class="fa-regular fa-heart text-white text-xl"></i>
                            </div>
                            ${Math.random() > 0.7 ? '<div class="absolute top-2 left-2 bg-k-pink text-white text-xs px-2 py-1 rounded-br-lg font-bold">熱銷</div>' : ''}
                        </div>
                        <div class="p-4 w-full md:w-2/3 flex flex-col justify-between">
                            <div>
                                <h3 class="text-xl font-bold mb-2 group-hover:text-k-pink transition">${data.title}</h3>
                                <div class="flex flex-wrap gap-2 mb-2">
                                    ${data.tags.map(tag => `<span class="text-xs bg-[#333] text-gray-300 px-2 py-1 rounded">${tag}</span>`).join('')}
                                </div>
                                <p class="text-sm text-gray-400 line-clamp-2">庫洛米嚴選！帶你體驗最不一樣的${data.tags[1] || '旅程'}之旅，絕對讓你印象深刻。</p>
                            </div>
                            <div class="flex justify-between items-end mt-4">
                                <div class="text-sm text-gray-500">可售日期: ${data.dates.slice(0, 3).join(', ')}</div>
                                <div class="text-right">
                                    <div class="text-gray-500 line-through text-sm">${data.originalPrice}</div>
                                    <div class="text-k-pink font-bold text-2xl">${data.price}</div>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
                container.insertAdjacentHTML('beforeend', html);
            });
            updateFavoriteUI();
        }

        // Apply Filters
        function applyFilters() {
            const priceFilters = Array.from(document.querySelectorAll('.filter-price:checked')).map(el => el.value);
            const themeFilters = Array.from(document.querySelectorAll('.filter-theme:checked')).map(el => el.value);
            const sortValue = document.getElementById('sort-select').value;

            let filtered = {};

            for (const [id, item] of Object.entries(itineraries)) {
                const price = parseInt(item.price.replace(/[$,]/g, ''));

                // Price Filter
                let priceMatch = false;
                if (priceFilters.length === 0) priceMatch = true;
                else {
                    if (priceFilters.includes('low') && price < 20000) priceMatch = true;
                    if (priceFilters.includes('mid') && price >= 20000 && price <= 40000) priceMatch = true;
                    if (priceFilters.includes('high') && price > 40000) priceMatch = true;
                }

                // Theme Filter (Mock logic based on tags or title keywords)
                // Since we don't have explicit theme fields, we'll do a loose match or just pass all if 'shopping' is checked (default)
                // For better demo, let's just assume all match unless specific keywords are found
                let themeMatch = true;
                // In a real app, we would check item.tags or item.category

                if (priceMatch && themeMatch) {
                    filtered[id] = item;
                }
            }

            // Sorting
            let sortedArray = Object.entries(filtered);
            if (sortValue === 'price-asc') {
                sortedArray.sort((a, b) => {
                    return parseInt(a[1].price.replace(/[$,]/g, '')) - parseInt(b[1].price.replace(/[$,]/g, ''));
                });
            } else if (sortValue === 'price-desc') {
                sortedArray.sort((a, b) => {
                    return parseInt(b[1].price.replace(/[$,]/g, '')) - parseInt(a[1].price.replace(/[$,]/g, ''));
                });
            }
            // popularity is default/random order

            // Convert back to object for renderItineraries (or modify renderItineraries to accept array)
            // My renderItineraries accepts object, so let's reconstruct
            let sortedObject = {};
            sortedArray.forEach(([key, val]) => sortedObject[key] = val);

            renderItineraries(sortedObject);
        }

        // Show Detail Page
        function showDetail(id) {
            const data = itineraries[id];
            if (!data) return;

            const detailSection = document.getElementById('detail');

            // Generate HTML
            let tagsHtml = data.tags.map(tag => `<span class="bg-gray-700 text-white px-3 py-1 rounded text-sm">${tag}</span>`).join('');
            let datesHtml = data.dates.map(date => `<option value="${date}">${date} - ${data.price}</option>`).join('');

            let daysHtml = data.days.map(day => `
                <div class="relative pl-12">
                    <div class="absolute left-0 top-1 w-10 h-10 bg-[#333] rounded-full flex items-center justify-center font-bold text-white border-4 border-[#1A1A1A] z-10">${day.day}</div>
                    <h3 class="text-xl font-bold text-white mb-2">${day.title}</h3>
                    <div class="bg-[#222] p-4 rounded-lg text-gray-300">
                        <p class="mb-2">${day.desc}</p>
                        ${day.stay ? `<p class="text-sm text-gray-400">住宿：${day.stay}</p>` : ''}
                        ${day.images ? `
                        <div class="mt-2 grid grid-cols-2 gap-2">
                            ${day.images.map(img => `<img src="${img}" class="rounded h-24 w-full object-cover">`).join('')}
                        </div>` : ''}
                    </div>
                </div>
            `).join('');

            detailSection.innerHTML = `
                <div class="bg-[#222] py-4 border-b border-[#3E204F]">
                    <div class="container mx-auto px-4">
                        <p class="text-gray-400 text-sm"><a href="#" onclick="router('home')" class="hover:text-k-pink">首頁</a> > <a href="#" onclick="router('search')" class="hover:text-k-pink">行程搜尋</a> > <span class="text-white">${data.title}</span></p>
                    </div>
                </div>
                <div class="container mx-auto px-4 py-8">
                    <div class="flex flex-col lg:flex-row gap-8">
                        <div class="w-full lg:w-2/3">
                            <h1 class="text-3xl font-bold mb-4 text-white leading-tight">${data.title}</h1>
                            <div class="flex gap-3 mb-6">${tagsHtml}</div>
                            <div class="rounded-xl overflow-hidden mb-8 h-[400px]">
                                <img src="${data.image}" class="w-full h-full object-cover">
                            </div>
                            <div class="border-b border-gray-700 mb-6">
                                <button class="px-6 py-3 text-k-pink border-b-2 border-k-pink font-bold">行程特色</button>
                                <button class="px-6 py-3 text-gray-400 hover:text-white">每日行程</button>
                                <button class="px-6 py-3 text-gray-400 hover:text-white">費用說明</button>
                            </div>
                            <div class="space-y-8 relative before:absolute before:left-[19px] before:top-2 before:h-full before:w-0.5 before:bg-gray-700">
                                ${daysHtml}
                            </div>
                        </div>
                        <div class="w-full lg:w-1/3">
                            <div class="bg-[#222] rounded-xl p-6 sticky top-24 border border-[#3E204F] shadow-2xl">
                                <h3 class="text-xl font-bold mb-4">選擇出發日期</h3>
                                <div class="mb-4">
                                    <select id="booking-date" class="w-full p-3 rounded bg-[#333] border border-gray-600">${datesHtml}</select>
                                </div>
                                <div class="flex justify-between items-center mb-2">
                                    <span class="text-gray-400">成人</span>
                                    <div class="flex items-center gap-3">
                                        <button onclick="updatePax('adult', -1)" class="w-8 h-8 rounded-full bg-[#444] hover:bg-gray-500">-</button>
                                        <span id="booking-adult-count">2</span>
                                        <button onclick="updatePax('adult', 1)" class="w-8 h-8 rounded-full bg-[#444] hover:bg-gray-500">+</button>
                                    </div>
                                </div>
                                <div class="flex justify-between items-center mb-6">
                                    <span class="text-gray-400">兒童</span>
                                    <div class="flex items-center gap-3">
                                        <button onclick="updatePax('child', -1)" class="w-8 h-8 rounded-full bg-[#444] hover:bg-gray-500">-</button>
                                        <span id="booking-child-count">0</span>
                                        <button onclick="updatePax('child', 1)" class="w-8 h-8 rounded-full bg-[#444] hover:bg-gray-500">+</button>
                                    </div>
                                </div>
                                <div class="border-t border-gray-700 pt-4 mb-6">
                                    <div class="flex justify-between items-center">
                                        <span class="font-bold">總金額</span>
                                        <span id="booking-total-price" class="text-3xl font-black text-k-pink">${data.price}</span>
                                    </div>
                                </div>
                                <button onclick="bookItinerary('${id}')" class="w-full btn-primary py-4 rounded-lg font-bold text-xl mb-2">立即預訂</button>
                                <p class="text-xs text-center text-gray-500"><i class="fa-solid fa-check-circle text-green-500"></i> 即時確認機位</p>
                            </div>
                        </div>
                    </div>
                </div>
            `;

            // Initialize price calculation
            updateTotalPrice(id);
            router('detail');
        }

        function updatePax(type, change) {
            const el = document.getElementById(`booking-${type}-count`);
            let count = parseInt(el.innerText);
            count += change;
            if (count < 0) count = 0;
            if (type === 'adult' && count < 1) count = 1; // Min 1 adult
            el.innerText = count;

            // Need ID to calculate price, but showDetail closure has it. 
            // However, onclick is global. We need to store current viewing ID or pass it.
            // Easier way: store current ID in a global var or data attribute.
            // Let's use a global var for simplicity in this prototype.
            updateTotalPrice(window.currentDetailId);
        }

        function updateTotalPrice(id) {
            window.currentDetailId = id; // Store for updatePax
            const data = itineraries[id];
            const adultCount = parseInt(document.getElementById('booking-adult-count').innerText);
            const childCount = parseInt(document.getElementById('booking-child-count').innerText);

            const basePrice = parseInt(data.price.replace(/[$,]/g, ''));
            const total = (basePrice * adultCount) + (basePrice * 0.8 * childCount); // Child 80% price

            document.getElementById('booking-total-price').innerText = '$' + total.toLocaleString();
        }

        function bookItinerary(id) {
            const data = itineraries[id];
            const date = document.getElementById('booking-date').value;
            const adultCount = parseInt(document.getElementById('booking-adult-count').innerText);
            const childCount = parseInt(document.getElementById('booking-child-count').innerText);
            const totalPrice = document.getElementById('booking-total-price').innerText;

            localStorage.setItem('currentBooking', JSON.stringify({
                type: 'itinerary',
                data: data,
                details: {
                    date: date,
                    adults: adultCount,
                    children: childCount,
                    total: totalPrice
                }
            }));
            router('checkout');
        }

        // Mobile Menu Toggle
        function toggleMobileMenu() {
            const menu = document.getElementById('mobile-menu');
            if (menu.classList.contains('hidden')) {
                menu.classList.remove('hidden');
                menu.classList.add('flex');
            } else {
                menu.classList.add('hidden');
                menu.classList.remove('flex');
            }
        }

        // Search Tab Switcher
        function switchSearchTab(tab) {
            // 1. Reset all tabs
            document.querySelectorAll('.search-tab').forEach(t => {
                t.classList.remove('active', 'text-white');
                t.classList.add('text-gray-400');
            });

            // 2. Hide all forms
            document.getElementById('flight-search-form').classList.add('hidden');
            document.getElementById('hotel-search-form').classList.add('hidden');
            document.getElementById('itinerary-search-form').classList.add('hidden');

            // 3. Activate selected tab
            const activeTab = document.getElementById(`tab-${tab}`);
            activeTab.classList.add('active', 'text-white');
            activeTab.classList.remove('text-gray-400');

            // 4. Show selected form
            document.getElementById(`${tab}-search-form`).classList.remove('hidden');
        }

        // Hotel Search Logic
        // Global Hotels Data - Diverse options for worldwide destinations
        const hotelsData = {
            // Asia
            'Japan': [
                '東京庫洛米霓虹酒店', '東京澀谷賽博龐克旅店', '東京六本木藝術飯店',
                '大阪美樂蒂溫泉旅館', '大阪道頓堀暗黑主題酒店',
                '京都酷企鵝町家', '京都哥德式禪意旅宿'
            ],
            'Korea': [
                '首爾弘大創意旅店', '首爾江南音樂酒店', '首爾明洞時尚飯店',
                '釜山海雲台搖滾旅館', '釜山南浦洞設計酒店',
                '濟州島火山景觀度假村'
            ],
            'Thailand': [
                '曼谷考山路背包客棧', '曼谷暹羅廣場精品酒店', '曼谷素坤逸藝術旅店',
                '清邁古城文青旅館', '芭達雅海灘派對酒店',
                '普吉島卡塔沙灘度假村'
            ],
            'Singapore': [
                '新加坡濱海灣設計酒店', '新加坡烏節路豪華飯店',
                '新加坡唐人街精品旅店', '聖淘沙度假村'
            ],
            'Taiwan': [
                '台北信義區庫洛米行館', '台北西門町潮流旅店', '台北東區時尚飯店',
                '高雄愛河美樂蒂會館', '台中逢甲夜市青年旅館',
                '台南安平古蹟民宿'
            ],

            // Europe
            'Germany': [
                '柏林Kreuzberg藝術旅店', '柏林Mitte工業風酒店',
                '慕尼黑瑪麗安廣場飯店', '漢堡港區設計旅館'
            ],
            'France': [
                '巴黎瑪黑區精品旅店', '巴黎蒙馬特藝術酒店', '巴黎拉丁區哥德飯店',
                '尼斯蔚藍海岸度假村', '里昂舊城區精品旅館'
            ],
            'Czech Republic': [
                '布拉格舊城哥德旅店', '布拉格城堡區精品酒店',
                '布拉格查理大橋景觀飯店'
            ],
            'Netherlands': [
                '阿姆斯特丹運河區精品旅店', '阿姆斯特丹Jordaan設計酒店',
                '鹿特丹現代建築飯店'
            ],
            'Iceland': [
                '雷克雅維克設計旅店', '維克黑沙灘Lodge',
                'Jokulsarlon冰河湖小屋', '藍湖溫泉度假村'
            ],
            'UK': [
                '倫敦Shoreditch嘻哈旅店', '倫敦Camden龐克酒店', '倫敦蘇活區精品飯店',
                '愛丁堡城堡區旅館', '曼徹斯特音樂主題酒店'
            ],
            'Spain': [
                '巴塞隆納哥德區旅店', '馬德里太陽門廣場飯店',
                '塞維亞佛朗明哥主題酒店', '伊比薩島派對度假村'
            ],
            'Italy': [
                '羅馬競技場景觀酒店', '佛羅倫斯藝術區精品旅店',
                '威尼斯運河旁貢多拉飯店', '米蘭時尚設計酒店'
            ],

            // Americas
            'USA': [
                '紐約布魯克林Loft旅店', '紐約曼哈頓SoHo精品酒店', '紐約哈林爵士飯店',
                '洛杉磯Santa Monica海灘旅館', '洛杉磯好萊塢星光飯店',
                '舊金山嬉皮區彩虹旅店', '拉斯維加斯Strip大道賭場酒店',
                '邁阿密South Beach派對酒店', '西雅圖咖啡文化旅館'
            ],
            'Mexico': [
                '墨西哥城歷史中心旅店', '墨西哥城亡靈節主題酒店',
                '瓜納華托彩色小鎮旅館', '坎昆加勒比海度假村'
            ],
            'Brazil': [
                '里約Copacabana海灘酒店', '里約森巴主題旅店',
                '聖保羅藝術區精品飯店', 'Salvador巴西古城旅館'
            ],
            'Argentina': [
                '布宜諾斯艾利斯探戈酒店', '巴塔哥尼亞冰川小屋'
            ],

            // Oceania
            'Australia': [
                '雪梨環形碼頭海港飯店', '雪梨The Rocks歷史旅店', '雪梨Bondi海灘衝浪旅館',
                '墨爾本咖啡文化精品酒店', '布里斯班南岸度假村',
                '黃金海岸衝浪者天堂飯店', '凱恩斯大堡礁潛水旅館'
            ],
            'New Zealand': [
                '奧克蘭天空塔景觀酒店', '奧克蘭Waiheke島酒莊旅館',
                '羅托魯瓦地熱溫泉飯店', '皇后鎮極限運動旅店',
                '威靈頓文化藝術酒店'
            ],

            // Africa & Middle East
            'Egypt': [
                '開羅尼羅河畔旅店', '開羅吉薩金字塔景觀酒店',
                '亞歷山大港地中海飯店', '路克索帝王谷旅館'
            ],
            'UAE': [
                '杜拜Burj Al Arab帆船酒店', '杜拜Marina區奢華飯店',
                '杜拜沙漠營地帳篷旅館', '阿布達比濱海大道酒店'
            ],
            'Morocco': [
                '馬拉喀什Riad傳統庭院旅店', '馬拉喀什Medina老城飯店',
                '撒哈拉沙漠豪華帳篷營地', '非斯古城迷宮旅館'
            ],
            'South Africa': [
                '開普敦V&A Waterfront飯店', '開普敦桌山景觀酒店',
                'Kruger國家公園Safari Lodge', '約翰尼斯堡市中心旅館'
            ]
        };

        // Itinerary Search Logic
        function searchItinerariesFromHome() {
            const origin = document.getElementById('itinerary-origin').value;
            const dest = document.getElementById('itinerary-dest').value.toLowerCase();
            const date = document.getElementById('itinerary-date').value;

            // Filter logic
            let filtered = {};
            let count = 0;

            for (const [id, item] of Object.entries(itineraries)) {
                let match = true;

                // Destination filter (loose match on title or tags)
                if (dest) {
                    const titleMatch = item.title.toLowerCase().includes(dest);
                    const tagMatch = item.tags.some(t => t.toLowerCase().includes(dest));
                    if (!titleMatch && !tagMatch) match = false;
                }

                // Date filter (check if any available date is after or equal to selected date)
                if (date && match) {
                    const selectedDate = new Date(date);
                    const hasValidDate = item.dates.some(d => new Date(d) >= selectedDate);
                    if (!hasValidDate) match = false;
                }

                // Origin filter (optional, assuming packages might have origin info in tags or description)
                // For now, we'll ignore origin as most packages are round trip from main hubs, 
                // or we can check if tags contain the origin code if we added it to tags.
                // Let's just log it for now.

                if (match) {
                    filtered[id] = item;
                    count++;
                }
            }

            if (count === 0) {
                alert('找不到符合條件的行程，顯示所有熱門行程。');
                renderItineraries(itineraries); // Show all if none found
            } else {
                renderItineraries(filtered);
            }

            router('search');
        }

        function updateHotelOptions() {
            const country = document.getElementById('hotel-country').value;
            const hotelSelect = document.getElementById('hotel-name');

            hotelSelect.innerHTML = '<option value="">請選擇飯店</option>';

            if (country && hotelsData[country]) {
                hotelsData[country].forEach(hotel => {
                    const option = document.createElement('option');
                    option.value = hotel;
                    option.innerText = hotel;
                    hotelSelect.appendChild(option);
                });
            } else {
                hotelSelect.innerHTML = '<option value="">請先選擇國家</option>';
            }
        }

        // Hotel Booking Logic
        let currentHotelBooking = null;

        function searchHotels() {
            const country = document.getElementById('hotel-country').value;
            const hotelName = document.getElementById('hotel-name').value;
            const roomType = document.getElementById('hotel-room-type').value;
            const hasBathtub = document.getElementById('hotel-bathtub').checked;
            const hasBreakfast = document.getElementById('hotel-breakfast').checked;

            if (!country || !hotelName) {
                alert('請選擇國家與飯店！');
                return;
            }

            // Mock Hotel Data
            const mockHotels = [
                {
                    id: 1,
                    name: hotelName,
                    country: country,
                    image: 'https://images.unsplash.com/photo-1566073771259-6a8506099945?q=80&w=2070&auto=format&fit=crop',
                    rating: 4.8,
                    price: 12000,
                    desc: '享受頂級的住宿體驗，充滿庫洛米風格的奢華設計。'
                },
                {
                    id: 2,
                    name: hotelName + ' (別館)',
                    country: country,
                    image: 'https://images.unsplash.com/photo-1582719478250-c89cae4dc85b?q=80&w=2070&auto=format&fit=crop',
                    rating: 4.5,
                    price: 9800,
                    desc: '溫馨舒適的選擇，適合家庭與情侶入住。'
                }
            ];

            renderHotelResults(mockHotels, roomType, hasBathtub, hasBreakfast);
            router('hotel-results');
        }

        function renderHotelResults(hotels, roomType, hasBathtub, hasBreakfast) {
            const container = document.getElementById('hotel-list');
            document.getElementById('hotel-results-title').innerText = `搜尋結果：${hotels[0].country} - ${hotels[0].name}`;

            container.innerHTML = hotels.map(h => `
                <div class="bg-[#222] rounded-xl overflow-hidden border border-gray-700 hover:border-k-pink transition-all duration-300 flex flex-col md:flex-row group">
                    <div class="md:w-1/3 h-64 md:h-auto relative overflow-hidden">
                        <img src="${h.image}" class="w-full h-full object-cover group-hover:scale-110 transition-transform duration-500">
                        <div class="absolute top-4 left-4 bg-k-pink text-white px-3 py-1 rounded font-bold text-sm">
                            ${h.rating} <i class="fa-solid fa-star text-xs"></i>
                        </div>
                    </div>
                    <div class="md:w-2/3 p-6 flex flex-col justify-between">
                        <div>
                            <h3 class="text-2xl font-bold mb-2 group-hover:text-k-pink transition">${h.name}</h3>
                            <p class="text-gray-400 mb-4">${h.desc}</p>
                            <div class="flex flex-wrap gap-2 mb-4">
                                <span class="bg-[#333] text-gray-300 px-3 py-1 rounded text-sm border border-gray-600">
                                    ${roomType === 'standard' ? '標準房' : roomType === 'deluxe' ? '豪華房' : '行政套房'}
                                </span>
                                ${hasBathtub ? '<span class="bg-[#333] text-gray-300 px-3 py-1 rounded text-sm border border-gray-600"><i class="fa-solid fa-bath mr-1"></i> 有浴缸</span>' : ''}
                                ${hasBreakfast ? '<span class="bg-[#333] text-gray-300 px-3 py-1 rounded text-sm border border-gray-600"><i class="fa-solid fa-utensils mr-1"></i> 附早餐</span>' : ''}
                            </div>
                        </div>
                        <div class="flex justify-between items-end border-t border-gray-700 pt-4">
                            <div>
                                <div class="text-xs text-gray-500">每晚房價</div>
                                <div class="text-3xl font-bold text-k-pink">$${h.price.toLocaleString()}</div>
                            </div>
                            <button onclick='openHotelBooking(${JSON.stringify(h)}, "${roomType}", ${hasBathtub}, ${hasBreakfast})' 
                                class="btn-primary px-8 py-3 rounded-lg font-bold hover:scale-105 transition-transform">
                                立即預訂
                            </button>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function openHotelBooking(hotel, roomType, hasBathtub, hasBreakfast) {
            currentHotelBooking = {
                hotel: hotel,
                roomType: roomType,
                hasBathtub: hasBathtub,
                hasBreakfast: hasBreakfast,
                nights: 4,
                tax: 2500
            };

            // Update Booking UI
            document.getElementById('booking-hotel-name').innerText = hotel.name;
            document.getElementById('booking-hotel-country').innerText = hotel.country;
            document.getElementById('booking-room-type').innerText = roomType === 'standard' ? '標準房' : roomType === 'deluxe' ? '豪華房' : '行政套房';
            document.getElementById('booking-has-bathtub').innerText = hasBathtub ? '有浴缸' : '無浴缸';
            document.getElementById('booking-has-breakfast').innerText = hasBreakfast ? '附早餐' : '不含早餐';

            const roomTotal = hotel.price * 4;
            document.getElementById('booking-room-price').innerText = `$${roomTotal.toLocaleString()}`;
            document.getElementById('booking-total-price').innerText = `$${(roomTotal + 2500).toLocaleString()}`;

            router('hotel-booking');
        }

        // Payment Processing
        function processPayment() {
            const bookingData = localStorage.getItem('currentBooking');

            if (!bookingData) {
                alert('找不到訂單資訊！');
                return;
            }

            const booking = JSON.parse(bookingData);

            // Generate order number
            const orderNumber = 'KM' + Date.now().toString().slice(-10);
            const paymentTime = new Date().toLocaleString('zh-TW', {
                year: 'numeric',
                month: '2-digit',
                day: '2-digit',
                hour: '2-digit',
                minute: '2-digit'
            });

            // Populate success page
            const detailsContainer = document.getElementById('success-booking-details');
            let detailsHTML = '';

            if (booking.type === 'flight') {
                const flight = booking.data;
                const details = booking.details;
                detailsHTML = `
                    <div class="pb-4 border-b border-gray-700">
                        <h3 class="font-bold text-lg mb-2">${flight.airline} ${flight.flightNo}</h3>
                        <div class="text-sm text-gray-400 space-y-1">
                            <p><i class="fa-solid fa-plane-departure mr-2 text-k-pink"></i> ${flight.dep} - ${flight.arr}</p>
                            <p><i class="fa-solid fa-clock mr-2 text-k-pink"></i> ${flight.duration}</p>
                            <p><i class="fa-solid fa-chair mr-2 text-k-pink"></i> ${details.cabin === 'economy' ? '經濟艙' : details.cabin === 'business' ? '商務艙' : '頭等艙'} - 座位 ${details.seat}</p>
                            <p><i class="fa-solid fa-utensils mr-2 text-k-pink"></i> ${details.meal}</p>
                        </div>
                    </div>
                `;
            } else if (booking.type === 'hotel') {
                const data = booking.data;
                detailsHTML = `
                    <div class="pb-4 border-b border-gray-700">
                        <h3 class="font-bold text-lg mb-2">${data.hotel.name}</h3>
                        <div class="text-sm text-gray-400 space-y-1">
                            <p><i class="fa-solid fa-location-dot mr-2 text-k-pink"></i> ${data.hotel.country}</p>
                            <p><i class="fa-solid fa-bed mr-2 text-k-pink"></i> ${data.roomType === 'standard' ? '標準房' : data.roomType === 'deluxe' ? '豪華房' : '行政套房'}</p>
                            <p><i class="fa-solid fa-calendar mr-2 text-k-pink"></i> 2023/12/20 - 12/24 (4晚)</p>
                            <p><i class="fa-solid fa-check mr-2 text-k-pink"></i> ${data.hasBathtub ? '浴缸' : ''} ${data.hasBreakfast ? '早餐' : ''}</p>
                        </div>
                    </div>
                `;
            } else if (booking.type === 'itinerary') {
                const itinerary = booking.data;
                const details = booking.details;
                detailsHTML = `
                    <div class="pb-4 border-b border-gray-700">
                        <h3 class="font-bold text-lg mb-2">${itinerary.title}</h3>
                        <div class="text-sm text-gray-400 space-y-1">
                            <p><i class="fa-solid fa-calendar-check mr-2 text-k-pink"></i> 出發日期：${details.date}</p>
                            <p><i class="fa-solid fa-users mr-2 text-k-pink"></i> 成人 ${details.adults} 位${details.children > 0 ? ' / 兒童 ' + details.children + ' 位' : ''}</p>
                            <p><i class="fa-solid fa-tags mr-2 text-k-pink"></i> ${itinerary.tags.join(' / ')}</p>
                        </div>
                    </div>
                `;
            }

            detailsContainer.innerHTML = detailsHTML;
            document.getElementById('success-order-number').innerText = orderNumber;
            document.getElementById('success-payment-time').innerText = paymentTime;
            document.getElementById('success-total-amount').innerText = booking.details.total;

            // Clear booking from localStorage
            localStorage.removeItem('currentBooking');

            // Navigate to success page
            router('payment-success');
        }

        function confirmHotelBooking() {
            const bookingDetails = {
                type: 'hotel',
                data: currentHotelBooking,
                details: {
                    total: document.getElementById('booking-total-price').innerText
                }
            };

            localStorage.setItem('currentBooking', JSON.stringify(bookingDetails));
            router('checkout');
        }

        // Simple SPA Router
        function router(pageId) {
            // 1. Hide all sections
            const sections = document.querySelectorAll('.page-section');
            sections.forEach(section => {
                section.classList.remove('active');
            });

            // 2. Show target section
            const target = document.getElementById(pageId);
            if (target) {
                target.classList.add('active');
            }

            // 3. Scroll to top
            window.scrollTo({ top: 0, behavior: 'smooth' });

            // 4. Special handling for page loads
            if (pageId === 'checkout') {
                loadCheckoutDetails();
            } else if (pageId === 'favorites') {
                renderFavoritesPage();
            }
        }

        // Flight Search System
        // Global Airlines Network - Worldwide flight options
        const airlinesData = {
            // Sanrio Theme Airlines
            'Kuromi Air': {
                logo: 'https://api.dicebear.com/7.x/identicon/svg?seed=KuromiAir',
                name: 'Kuromi Air',
                desc: '最叛逆的飛行體驗，提供暗黑哥德風主題餐點與專屬搖滾頻道。全球航線覆蓋東京、首爾、柏林、紐約等潮流城市。',
                features: ['龐克搖滾播放清單', '骷髏頭造型餐具', '專屬叛逆空服員', '全球WiFi', '哥德風機艙']
            },
            'Melody Airways': {
                logo: 'https://api.dicebear.com/7.x/identicon/svg?seed=MelodyAir',
                name: 'Melody Airways',
                desc: '粉紅夢幻的空中之旅，充滿蕾絲與花朵的浪漫氛圍。飛往巴黎、里約、雪梨等浪漫目的地。',
                features: ['粉紅香檳無限暢飲', '花香精油熱毛巾', '古典樂舒壓頻道', '玫瑰花瓣迎賓', '夢幻座艙']
            },
            'Badtz-Maru Jet': {
                logo: 'https://api.dicebear.com/7.x/identicon/svg?seed=XOJet',
                name: 'Badtz-Maru Jet',
                desc: '酷企鵝的帥氣專機，極簡黑白風格，個性十足。主飛航線：東京-洛杉磯、首爾-紐約、新加坡-倫敦。',
                features: ['XO醬高級飛機餐', '黑白棋娛樂系統', '帥氣墨鏡租借', 'VR遊戲', '極簡設計座艙']
            },

            // Additional Global Carriers
            'Cinnamoroll Sky': {
                logo: 'https://api.dicebear.com/7.x/identicon/svg?seed=CinnamorollSky',
                name: 'Cinnamoroll Sky',
                desc: '雲朵般輕柔的飛行體驗，專飛冰島、紐西蘭等夢幻自然景觀航線。',
                features: ['雲朵造型座椅', '肉桂卷點心', '極光觀賞艙', '兒童遊樂區', '寵物友善']
            },
            'Pompompurin Express': {
                logo: 'https://api.dicebear.com/7.x/identicon/svg?seed=Pompompurin',
                name: 'Pompompurin Express',
                desc: '舒適悠閒的布丁狗航空，主打歐洲城市跳島，巴黎-阿姆斯特丹-布拉格航線。',
                features: ['布丁甜點吧', '懶人躺椅', '下午茶服務', '歐洲美食', '舒壓按摩']
            },
            'Little Twin Stars Galaxy': {
                logo: 'https://api.dicebear.com/7.x/identicon/svg?seed=TwinStars',
                name: 'Little Twin Stars Galaxy',
                desc: '星空主題長程航線，專飛跨洲際航班：東京-紐約、巴黎-雪梨、杜拜-洛杉磯。',
                features: ['星空投影天花板', '太空艙座椅', '無重力體驗', '天文望遠鏡', '星座雞尾酒']
            },
            'Keroppi Frog Air': {
                logo: 'https://api.dicebear.com/7.x/identicon/svg?seed=Keroppi',
                name: 'Keroppi Frog Air',
                desc: '環保生態航空，飛往生態旅遊勝地：哥斯大黎加、巴西亞馬遜、澳洲大堡礁。',
                features: ['有機餐點', '碳中和飛行', '生態紀錄片', '雨林音樂', '環保紀念品']
            },
            'Gudetama Lazy Flight': {
                logo: 'https://api.dicebear.com/7.x/identicon/svg?seed=Gudetama',
                name: 'Gudetama Lazy Flight',
                desc: '慵懶蛋黃哥航空，主打紅眼航班與超長程航線，提供最舒適的睡眠體驗。',
                features: ['全平躺臥鋪', '蛋料理吧', '靜音艙', '睡眠香氛', '無限賴床時間']
            }
        };

        let currentFlight = null;
        let selectedCabin = 'economy';
        let selectedSeat = null;
        let selectedMeal = 'standard';

        function searchFlights() {
            const origin = document.getElementById('flight-origin').value;
            const dest = document.getElementById('flight-dest').value;
            const date = document.getElementById('flight-date').value;
            const airline = document.getElementById('flight-airline').value;

            // Mock Data Generation
            const mockFlights = [
                { id: 1, airline: 'Kuromi Air', flightNo: 'KA666', dep: '09:00', arr: '13:00', duration: '4h 00m', price: 12000 },
                { id: 2, airline: 'Melody Airways', flightNo: 'MA520', dep: '14:30', arr: '18:45', duration: '4h 15m', price: 13500 },
                { id: 3, airline: 'Badtz-Maru Jet', flightNo: 'XO888', dep: '19:00', arr: '23:00', duration: '4h 00m', price: 11800 },
                { id: 4, airline: 'Kuromi Air', flightNo: 'KA999', dep: '23:30', arr: '03:30', duration: '4h 00m', price: 10500 }
            ];

            // Filter (Mock logic)
            let results = mockFlights;
            if (airline !== 'all') {
                results = results.filter(f => f.airline === airlinesData[airline].name);
            }

            renderFlightResults(results, origin, dest, date);
            router('flight-results');
        }

        function renderFlightResults(flights, origin, dest, date) {
            const container = document.getElementById('flight-list');
            document.getElementById('flight-results-title').innerText = `搜尋結果：${origin} 往 ${dest} (${date})`;

            if (flights.length === 0) {
                container.innerHTML = '<div class="text-center text-gray-400 py-8">找不到符合條件的航班</div>';
                return;
            }

            container.innerHTML = flights.map(f => `
                <div class="bg-[#222] rounded-xl overflow-hidden border border-gray-700 hover:border-k-pink transition-all duration-300 flex flex-col md:flex-row group">
                    <div class="md:w-1/4 bg-[#2A2A2A] p-6 flex flex-col items-center justify-center border-r border-gray-700 relative overflow-hidden">
                        <div class="absolute inset-0 bg-k-pink/5 group-hover:bg-k-pink/10 transition-colors"></div>
                        <img src="${airlinesData[f.airline].logo}" class="w-16 h-16 mb-2 rounded-full bg-white p-1">
                        <span class="font-bold text-lg relative z-10">${f.airline}</span>
                        <span class="text-xs text-gray-400 relative z-10">${f.flightNo}</span>
                        <button onclick="showAirlineInfo('${f.airline}')" class="text-xs text-k-pink mt-2 hover:underline relative z-10"><i class="fa-solid fa-circle-info"></i> 航空資訊</button>
                    </div>
                    <div class="md:w-2/4 p-6 flex flex-col justify-center">
                        <div class="flex justify-between items-center mb-4">
                            <div class="text-center">
                                <div class="text-2xl font-bold">${f.dep}</div>
                                <div class="text-sm text-gray-400">${origin}</div>
                            </div>
                            <div class="flex-1 px-4 flex flex-col items-center">
                                <div class="text-xs text-gray-500 mb-1">${f.duration}</div>
                                <div class="w-full h-[2px] bg-gray-600 relative">
                                    <div class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-2 h-2 bg-k-pink rounded-full"></div>
                                </div>
                                <div class="text-xs text-k-pink mt-1">直飛</div>
                            </div>
                            <div class="text-center">
                                <div class="text-2xl font-bold">${f.arr}</div>
                                <div class="text-sm text-gray-400">${dest}</div>
                            </div>
                        </div>
                    </div>
                    <div class="md:w-1/4 p-6 flex flex-col justify-center items-end bg-[#252525] border-l border-gray-700">
                        <div class="text-3xl font-bold text-k-pink mb-1">$${f.price.toLocaleString()}</div>
                        <div class="text-xs text-gray-500 mb-4">經濟艙 / 每人</div>
                        <button onclick='openFlightBooking(${JSON.stringify(f)})' class="btn-primary w-full py-3 rounded-lg font-bold hover:scale-105 transition-transform">立即預訂</button>
                    </div>
                </div>
            `).join('');
        }

        function showAirlineInfo(airlineName) {
            const data = airlinesData[airlineName];
            if (!data) return;
            document.getElementById('modal-airline-logo').src = data.logo;
            document.getElementById('modal-airline-name').innerText = data.name;
            document.getElementById('modal-airline-desc').innerText = data.desc;
            document.getElementById('modal-airline-features').innerHTML = data.features.map(f => `<li>${f}</li>`).join('');
            document.getElementById('airline-modal').classList.remove('hidden');
            document.getElementById('airline-modal').classList.add('flex');
        }

        function closeAirlineModal() {
            document.getElementById('airline-modal').classList.add('hidden');
            document.getElementById('airline-modal').classList.remove('flex');
        }

        function openFlightBooking(flight) {
            currentFlight = flight;
            selectedCabin = 'economy';
            selectedSeat = null;
            selectedMeal = 'standard';

            // Update UI for booking page
            updateBookingUI();
            renderSeatMap();

            router('flight-booking');
        }

        function selectCabin(cabin) {
            selectedCabin = cabin;
            document.querySelectorAll('.cabin-btn').forEach(btn => {
                btn.classList.remove('border-k-pink', 'bg-k-pink/10');
                btn.classList.add('border-gray-600');
            });
            const btn = document.getElementById(`btn-${cabin}`);
            btn.classList.remove('border-gray-600');
            btn.classList.add('border-k-pink', 'bg-k-pink/10');

            updateBookingUI();
        }

        function renderSeatMap() {
            const map = document.getElementById('seat-map');
            map.innerHTML = '';

            const rows = 10;
            const cols = ['A', 'B', 'C', '', 'D', 'E', 'F'];

            for (let i = 1; i <= rows; i++) {
                const rowDiv = document.createElement('div');
                rowDiv.className = 'flex gap-2 mb-2';

                cols.forEach(col => {
                    if (col === '') {
                        const aisle = document.createElement('div');
                        aisle.className = 'w-8 text-center text-gray-600 text-xs flex items-center justify-center';
                        aisle.innerText = i;
                        rowDiv.appendChild(aisle);
                    } else {
                        const seatId = `${i}${col}`;
                        const isOccupied = Math.random() < 0.3;
                        const seat = document.createElement('button');
                        seat.className = `w-10 h-10 rounded flex items-center justify-center text-xs font-bold transition-colors ${isOccupied ? 'bg-gray-700 text-gray-500 cursor-not-allowed' :
                            (selectedSeat === seatId ? 'bg-k-pink text-white' : 'bg-[#333] border border-gray-600 hover:border-k-pink text-gray-300')
                            }`;
                        seat.innerText = col;
                        if (!isOccupied) {
                            seat.onclick = () => selectSeat(seatId);
                        } else {
                            seat.disabled = true;
                        }
                        rowDiv.appendChild(seat);
                    }
                });
                map.appendChild(rowDiv);
            }
        }

        function selectSeat(seatId) {
            selectedSeat = seatId;
            renderSeatMap(); // Re-render to update styles
            updateBookingUI();
        }

        function updateBookingUI() {
            if (!currentFlight) return;

            // Prices
            const basePrice = currentFlight.price;
            const multipliers = { 'economy': 1, 'business': 2.5, 'first': 4 };

            document.getElementById('price-economy').innerText = `$${basePrice.toLocaleString()}`;
            document.getElementById('price-business').innerText = `$${(basePrice * 2.5).toLocaleString()}`;
            document.getElementById('price-first').innerText = `$${(basePrice * 4).toLocaleString()}`;

            // Summary
            const cabinPrice = basePrice * multipliers[selectedCabin];
            const tax = 500;
            const total = cabinPrice + tax;

            const summary = document.getElementById('booking-summary-content');
            summary.innerHTML = `
                <div class="flex justify-between">
                    <span>航班</span>
                    <span class="font-bold text-white">${currentFlight.airline} ${currentFlight.flightNo}</span>
                </div>
                <div class="flex justify-between">
                    <span>艙等</span>
                    <span class="font-bold text-white capitalize">${selectedCabin === 'economy' ? '經濟艙' : selectedCabin === 'business' ? '商務艙' : '頭等艙'}</span>
                </div>
                <div class="flex justify-between">
                    <span>座位</span>
                    <span class="font-bold text-k-pink">${selectedSeat || '未選擇'}</span>
                </div>
                <div class="flex justify-between">
                    <span>餐點</span>
                    <span class="font-bold text-white">${document.getElementById('flight-meal').options[document.getElementById('flight-meal').selectedIndex].text}</span>
                </div>
                <div class="flex justify-between border-t border-gray-700 pt-2 mt-2">
                    <span>稅金 & 費用</span>
                    <span>$${tax}</span>
                </div>
            `;

            document.getElementById('flight-total-price').innerText = `$${total.toLocaleString()}`;
        }

        function confirmFlightBooking() {
            if (!selectedSeat) {
                alert('請選擇座位！');
                return;
            }

            const bookingDetails = {
                type: 'flight',
                data: currentFlight,
                details: {
                    cabin: selectedCabin,
                    seat: selectedSeat,
                    meal: document.getElementById('flight-meal').value,
                    total: document.getElementById('flight-total-price').innerText
                }
            };

            localStorage.setItem('currentBooking', JSON.stringify(bookingDetails));
            router('checkout');
        }

        // Load Checkout Details
        function loadCheckoutDetails() {
            const bookingData = localStorage.getItem('currentBooking');
            const orderSummary = document.getElementById('order-summary');
            const totalAmount = document.getElementById('order-total');
            const emptyCart = document.getElementById('empty-cart');
            const checkoutContent = document.getElementById('checkout-content');

            // If no booking data, show empty cart state
            if (!bookingData) {
                emptyCart.classList.remove('hidden');
                checkoutContent.classList.add('hidden');
                return;
            }

            // Show checkout content, hide empty cart
            emptyCart.classList.add('hidden');
            checkoutContent.classList.remove('hidden');

            const booking = JSON.parse(bookingData);

            if (booking.type === 'flight') {
                const flight = booking.data;
                const details = booking.details;

                orderSummary.innerHTML = `
            <div class="flex justify-between mb-2">
                <span>機票 (${flight.airline})</span>
                <span class="font-bold text-white">${flight.airline} ${flight.flightNo}</span>
            </div>
            <div class="flex justify-between mb-2 text-sm text-gray-400">
                <span>艙等 (${details.cabin})</span>
                <span>${details.cabin === 'economy' ? '包含' : '升等費'}</span>
            </div>
             <div class="flex justify-between mb-2 text-sm text-gray-400">
                <span>稅金 & 費用</span>
                <span>$500</span>
            </div>
        `;
                totalAmount.innerText = details.total;
            } else if (booking.type === 'hotel') {
                const data = booking.data;
                const details = booking.details;

                orderSummary.innerHTML = `
            <div class="mb-4 border-b border-gray-700 pb-2">
                <h4 class="font-bold text-sm mb-1">${data.hotel.name}</h4>
                <p class="text-xs text-gray-400">2023/12/20 - 12/24 (4晚)</p>
            </div>
            <div class="flex justify-between text-sm mb-2">
                <span class="text-gray-400">房型</span>
                <span>${data.roomType === 'standard' ? '標準房' : data.roomType === 'deluxe' ? '豪華房' : '行政套房'}</span>
            </div>
            <div class="flex justify-between text-sm mb-2">
                <span class="text-gray-400">設施</span>
                <span>${data.hasBathtub ? '浴缸' : ''} ${data.hasBreakfast ? '早餐' : ''}</span>
            </div>
        `;
                totalAmount.innerText = details.total;
            } else if (booking.type === 'itinerary') {
                const itinerary = booking.data;
                const details = booking.details || { adults: 2, children: 0, total: itinerary.price, date: '未選擇' };

                orderSummary.innerHTML = `
            <div class="mb-4 border-b border-gray-700 pb-2">
                <h4 class="font-bold text-sm mb-1">${itinerary.title}</h4>
                <p class="text-xs text-gray-400">出發日期: ${details.date}</p>
            </div>
            <div class="flex justify-between text-sm mb-2">
                <span class="text-gray-400">成人 x ${details.adults}</span>
                <span>$${(parseInt(itinerary.price.replace(/[$,]/g, '')) * details.adults).toLocaleString()}</span>
            </div>
            ${details.children > 0 ? `
            <div class="flex justify-between text-sm mb-2">
                <span class="text-gray-400">兒童 x ${details.children}</span>
                <span>$${(parseInt(itinerary.price.replace(/[$,]/g, '')) * 0.8 * details.children).toLocaleString()}</span>
            </div>` : ''}
            <div class="flex justify-between text-sm mb-4">
                <span class="text-gray-400">折扣碼 (KUROMI2023)</span>
                <span class="text-k-pink">-$1,000</span>
            </div>
        `;

                let finalTotal = parseInt(details.total.replace(/[$,]/g, '')) - 1000;
                if (finalTotal < 0) finalTotal = 0;

                totalAmount.innerText = '$' + finalTotal.toLocaleString();
            }

            // Update cart badge
            updateCartBadge();
        }

        // Update Cart Badge
        function updateCartBadge() {
            const badge = document.getElementById('cart-badge');
            const bookingData = localStorage.getItem('currentBooking');

            if (badge) { // Check if badge element exists
                if (bookingData) {
                    badge.innerText = '1';
                    badge.classList.remove('hidden');
                } else {
                    badge.innerText = '0';
                    badge.classList.add('hidden');
                }
            }
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', function () {
            // Clear any existing booking data on page load for fresh start
            localStorage.removeItem('currentBooking');

            generateItineraries();
            renderItineraries();
            loadFavorites(); // Load wishlist from localStorage
            initScrollAnimations(); // Init scroll observer
            initParallax(); // Init parallax effect
            router('home'); // Default to home page

            // Update cart badge
            updateCartBadge();

            // Flight meal selection listener
            const mealSelect = document.getElementById('flight-meal');
            if (mealSelect) {
                mealSelect.addEventListener('change', updateBookingUI);
            }
        });
    </script>
</body>

</html>
```